ğŸ“˜ Noctria Kingdom å¼•ãç¶™ãæ›¸ï¼ˆ2025-06-24ã€œ25ï¼‰
ğŸ—“ å®Ÿæ–½æ¦‚è¦
é …ç›®	å†…å®¹
å¯¾è±¡æ©Ÿèƒ½	veritas_master_dag ã® API èµ·å‹•ã¨ run_noctus ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œç¢ºèª
ä¸»ãªä¿®æ­£ç‚¹	Airflow REST API èªè¨¼èª¿æ•´ãƒ»DAGãƒˆãƒªã‚¬ãƒ¼ç¢ºèªãƒ»ãƒªã‚¹ã‚¯ç®¡ç†AIãƒã‚°ä¿®æ­£
æˆæœ	NoctusSentinella ã® DAG å®Ÿè¡Œã¨å¸‚å ´ãƒªã‚¹ã‚¯è©•ä¾¡ã«æˆåŠŸ ğŸ‰

ğŸ§° ä½œæ¥­ãƒ­ã‚°
1. Airflow Web/API æ¥ç¶šã¨ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
curl ã«ã‚ˆã‚‹ localhost:8080/api/v1/dags å®Ÿè¡Œæ™‚ã« 403 Forbidden ç™ºç”Ÿ
â†’ åŸå› : airflow.cfg ã®èªè¨¼è¨­å®šãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã«å•é¡Œã‚ã‚Š

airflow-webserver ã®ãƒ­ã‚°ã§ Login Failed for user: airflow ã‚’ç¢ºèª

Airflow èµ·å‹•ãƒ­ã‚°ã«ã¦ User "airflow" created with role "Admin" ã‚’ç¢ºèªï¼ˆæˆåŠŸï¼‰

2. .env ãƒ•ã‚¡ã‚¤ãƒ«è¡çªã®è§£æ¶ˆ
git pull æ™‚ã€.env ã®ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ›´ãŒåŸå› ã§ pull å¤±æ•—

è§£æ±ºç­–: .env ã‚’ä¸€æ™‚é€€é¿ or commit/stash

3. Airflow DAGèµ·å‹•ç¢ºèªï¼ˆAPIï¼‰
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
curl -u airflow:airflow -X POST http://localhost:8080/api/v1/dags/veritas_master_dag/dagRuns \
  -H "Content-Type: application/json" \
  -d '{"conf": {"source": "GUI"}}'
âœ… DAGãŒ queued çŠ¶æ…‹ã§èµ·å‹• â†’ ãƒ­ã‚°ãŒ /log/dag_id=veritas_master_dag/... ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«

4. run_noctus ã‚¿ã‚¹ã‚¯ã®ã‚¨ãƒ©ãƒ¼ã¨ä¿®æ­£
âŒ åˆå›ã‚¨ãƒ©ãƒ¼å†…å®¹:
css
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
TypeError: setup_logger() missing 1 required positional argument: 'log_file'
è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«: /strategies/noctus_sentinella.py â†’ MarketDataFetcher ã® setup_logger() å‘¼ã³å‡ºã—ã«å¼•æ•°æ¼ã‚Œ

âœ… ä¿®æ­£å†…å®¹:
core/utils.py ã«ã‚ã‚‹ setup_logger(name: str, log_file: str) ã«å¯¾ã—ã¦ "MarketDataFetcher.log" ã‚’æ˜ç¤ºæŒ‡å®š

python
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
self.logger = setup_logger("MarketDataFetcher", "MarketDataFetcher.log")
5. RiskManagement ã®å±æ€§ã‚¨ãƒ©ãƒ¼ã¨ä¿®æ­£
âŒ ã‚¨ãƒ©ãƒ¼å†…å®¹:
pgsql
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
AttributeError: 'RiskManagement' object has no attribute 'calculate_var'
âœ… ä¿®æ­£å†…å®¹:
calculate_var() ã¯ private ã§ã¯ãªã public ã«ã™ã¹ã

å¯¾å¿œæ¡ˆ1: self.value_at_risk ã®åˆæœŸåŒ–ã ã‘ä½¿ç”¨ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã§OKï¼‰

å¯¾å¿œæ¡ˆ2: calculate_var() ã‚’å¿…è¦ãªã‚‰ public åŒ–ï¼ˆä»Šå›ã¯æœªä½¿ç”¨ã§å›é¿å¯èƒ½ï¼‰

6. æœ€çµ‚æˆåŠŸãƒ­ã‚°
log
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: (517, 5)
ğŸ“Š å¸‚å ´ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£: 0.042
ğŸ’¥ VaR: 0.035
ğŸ›¡ï¸ ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹: 97.9
ğŸš¨ ç•°å¸¸æ¤œçŸ¥: False
ğŸ“ˆ ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚º: 571.4
ğŸ—‚ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆæŠœç²‹ï¼‰
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
noctria-kingdom-main/
â”œâ”€â”€ airflow_docker/
â”‚   â”œâ”€â”€ dags/
â”‚   â”‚   â””â”€â”€ veritas_master_dag.py      # Veritas Master DAGå®šç¾©ï¼ˆNoctuså®Ÿè¡Œå«ã‚€ï¼‰
â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â””â”€â”€ noctus_sentinella.py       # ãƒªã‚¹ã‚¯ç®¡ç†AIï¼ˆNoctusï¼‰
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ market_data_fetcher.py     # å¸‚å ´ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆYahoo Financeï¼‰
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ risk_management.py         # VaRãƒ»ç•°å¸¸æ¤œçŸ¥ãƒ»ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â””â”€â”€ .env                           # APIã‚­ãƒ¼ãƒ»DBæ¥ç¶šæƒ…å ±ãªã©ï¼ˆç§˜åŒ¿ï¼‰
ğŸ“Œ è£œè¶³ãƒ¡ãƒ¢
airflow.cfg ã® [api] auth_backends è¨­å®šã¯ Airflow 2.x ã‹ã‚‰ auth_backend â†’ auth_backends ã¸ç§»è¡Œæ¸ˆï¼ˆæ³¨æ„ï¼‰

.env å¤‰æ›´æ™‚ã¯ .gitignore ã®æ‰±ã„ã«æ³¨æ„ï¼ˆå…±æœ‰ã›ãšãƒ­ãƒ¼ã‚«ãƒ«å®šç¾©ï¼‰

triggerer, dag_processor ã® heartbeat ãŒ null ã®ã¾ã¾ â†’ ã‚³ãƒ³ãƒ†ãƒŠæœªèµ·å‹•ã¾ãŸã¯æ¥ç¶šä¸è‰¯ã®å¯èƒ½æ€§ã‚ã‚Š

âœ… æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰
å„ªå…ˆåº¦	å†…å®¹
â˜…â˜…â˜…	run_aurus, run_levia, run_prometheus å„æˆ¦ç•¥ã® DAG å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
â˜…â˜…â˜†	FastAPI â†’ DAGãƒˆãƒªã‚¬ãƒ¼API â†’ çµæœå–å¾—ã®GUIé€£æºç¢ºèª
â˜…â˜†â˜†	triggererãƒ»dag_processor ã®èµ·å‹•ç¢ºèªã¨ãƒ­ã‚°ç›£è¦–å¯¾å¿œ
