{% extends "base_hud.html" %}

{% block title %}ğŸ“Š çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}
{% block header_icon %}<i class="fas fa-database"></i>{% endblock %}
{% block header_title %}STRATEGY STATISTICS{% endblock %}
{% block header_nav_href %}/statistics{% endblock %}
{% block header_nav_text %}çµ±è¨ˆä¸€è¦§{% endblock %}

{% block content %}
<section class="hud-panel metrics">
  <h2 class="panel-title">çµ±è¨ˆæ¦‚è¦</h2>
  <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
    <div class="metric-item">
      <h3><i class="fas fa-chart-line"></i> å¹³å‡å‹ç‡</h3>
      <p class="metric-value text-green">
        {% if stats and stats.get("avg_win_rate") is not none %}
          {{ "%.2f"|format(stats["avg_win_rate"]) }}%
        {% else %}-{% endif %}
      </p>
    </div>
    <div class="metric-item">
      <h3><i class="fas fa-bolt"></i> å¹³å‡DD</h3>
      <p class="metric-value text-red">
        {% if stats and stats.get("avg_drawdown") is not none %}
          {{ "%.2f"|format(stats["avg_drawdown"]) }}%
        {% else %}-{% endif %}
      </p>
    </div>
    <div class="metric-item">
      <h3><i class="fas fa-layer-group"></i> æˆ¦ç•¥æ•°</h3>
      <p class="metric-value">
        {{ stats.get("num_strategies", "-") }}
      </p>
    </div>
  </div>
</section>

<section class="hud-panel">
  <h2 class="panel-title"><i class="fas fa-tags"></i> ã‚¿ã‚°åˆ¥åˆ†å¸ƒ</h2>
  <canvas id="tagPieChart" style="max-width: 100%; height: auto;"></canvas>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tagDist = {{ stats.get("tag_distribution", {}) | tojson }};
  
  // ã‚°ãƒ©ãƒ•ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
  const ctx = document.getElementById('tagPieChart').getContext('2d');
  const labels = Object.keys(tagDist);
  const data = Object.values(tagDist);

  // Chart.js ã‚’ä½¿ã£ã¦å††ã‚°ãƒ©ãƒ•ã‚’æç”»
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{
        label: 'æˆ¦ç•¥æ•°',
        data: data,
        backgroundColor: [
          'rgba(0, 229, 255, 0.6)',
          'rgba(0, 153, 255, 0.6)',
          'rgba(0, 102, 204, 0.6)',
          'rgba(0, 204, 153, 0.6)',
          'rgba(255, 204, 102, 0.6)',
          'rgba(255, 102, 153, 0.6)',
          'rgba(153, 102, 255, 0.6)'
        ],
        borderColor: 'rgba(0, 229, 255, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'right',
          labels: {
            color: '#cceeff',
            font: {
              family: 'Roboto Mono',
              size: 14
            }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 30, 60, 0.8)',
          borderColor: '#00e5ff',
          borderWidth: 1
        }
      }
    }
  });
});
</script>
{% endblock %}
