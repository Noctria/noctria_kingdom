<!-- noctria_gui/templates/codex.html -->
{% extends "base_hud.html" %}

{% block title %}{{ page_title or "🧪 Codex Mini-Loop" }} - Noctria Kingdom{% endblock %}
{% block header_icon %}<i class="fas fa-vial"></i>{% endblock %}
{% block header_title %}CODEX MINI-LOOP{% endblock %}
{% block header_nav_href %}/dashboard{% endblock %}
{% block header_nav_text %}DASHBOARD{% endblock %}

{% block extra_head %}
<style>
  .codex-grid { display:grid; grid-template-columns: 1fr; gap: 1rem; }
  @media (min-width: 1100px) { .codex-grid { grid-template-columns: 1fr 1fr; } }
  .hud-card { background: rgba(0,0,0,.35); border:1px solid var(--panel-border, #2b2b2b); border-radius: 12px; padding: 1rem; box-shadow: 0 0 20px rgba(0,255,180,.06) inset; }
  .hud-pre { background: rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.06); padding:.75rem; border-radius:8px; max-height: 420px; overflow:auto; font-size: .9rem; }
  .hud-actions { display:flex; gap:.5rem; align-items:center; }
  .hud-btn { padding:.5rem .9rem; border-radius: 10px; border:1px solid var(--panel-border,#2b2b2b); background: linear-gradient(180deg, rgba(0,255,180,.10), rgba(0,255,180,.02)); cursor:pointer; }
  .hud-btn:hover { filter:brightness(1.1); }
  .hud-small { opacity:.8; font-size:.85rem; }
  .hud-link { color: var(--glow-primary, #0ff); text-decoration: none; }
</style>
{% endblock %}

{% block content %}
<div class="hud-section">
  <div class="hud-actions">
    <form action="/codex/run" method="post">
      <button class="hud-btn" type="submit"><i class="fas fa-play"></i> Run Mini-Loop</button>
    </form>
    <span class="hud-small">pytestは既定 <code>-q</code>。詳細は <code>codex/mini_loop.py</code> を参照。</span>
  </div>
</div>

<div class="codex-grid">
  <div class="hud-card">
    <h3>Latest Cycle (Markdown)</h3>
    {% if reports.latest_cycle %}
      <p class="hud-small"><a class="hud-link" href="/{{ reports.latest_cycle|replace('\\','/') }}" target="_blank">Open file</a></p>
      <pre class="hud-pre">{{ previews.latest_cycle }}</pre>
    {% else %}
      <p class="hud-small">まだ生成されていません。</p>
    {% endif %}
  </div>

  <div class="hud-card">
    <h3>Mini-Loop Summary</h3>
    {% if reports.mini_summary %}
      <p class="hud-small"><a class="hud-link" href="/{{ reports.mini_summary|replace('\\','/') }}" target="_blank">Open file</a></p>
      <pre class="hud-pre">{{ previews.mini_summary }}</pre>
    {% else %}
      <p class="hud-small">未実行。</p>
    {% endif %}
  </div>

  <div class="hud-card">
    <h3>Inventor Suggestions</h3>
    {% if reports.inventor %}
      <p class="hud-small"><a class="hud-link" href="/{{ reports.inventor|replace('\\','/') }}" target="_blank">Open file</a></p>
      <pre class="hud-pre">{{ previews.inventor }}</pre>
    {% else %}
      <p class="hud-small">まだ提案なし。</p>
    {% endif %}
  </div>

  <div class="hud-card">
    <h3>Harmonia Review</h3>
    {% if reports.harmonia %}
      <p class="hud-small"><a class="hud-link" href="/{{ reports.harmonia|replace('\\','/') }}" target="_blank">Open file</a></p>
      <pre class="hud-pre">{{ previews.harmonia }}</pre>
    {% else %}
      <p class="hud-small">まだレビューなし。</p>
    {% endif %}
  </div>
</div>
{% endblock %}
