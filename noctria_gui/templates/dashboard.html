<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ° Noctria Kingdom - ä¸­å¤®çµ±æ²»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition duration-300 font-sans p-4 md:p-6">
  <header class="mb-6 flex flex-col md:flex-row justify-between items-center">
    <h1 class="text-2xl md:text-3xl font-bold">ğŸ° Noctria Kingdom - ä¸­å¤®çµ±æ²»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    <button id="darkModeToggle" class="mt-2 md:mt-0 px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">ğŸŒ™ Dark Mode</button>
  </header>

  <!-- çµ±è¨ˆHUD -->
  <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
      <h2 class="text-lg font-semibold mb-2">ğŸ“ˆ å¹³å‡å‹ç‡</h2>
      <p class="text-2xl">{{ stats.avg_win_rate }}%</p>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
      <h2 class="text-lg font-semibold mb-2">ğŸ“Œ æ¡ç”¨æ•°</h2>
      <p class="text-2xl">{{ stats.promoted_count }}</p>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
      <h2 class="text-lg font-semibold mb-2">ğŸš€ Pushæ•°</h2>
      <p class="text-2xl">{{ stats.pushed_count }}</p>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 col-span-1 md:col-span-2">
      <h2 class="text-lg font-semibold mb-2">ğŸ”® Oracleç²¾åº¦è©•ä¾¡</h2>
      <ul class="list-disc ml-6">
        <li>RMSE: {{ stats.oracle_metrics.RMSE }}</li>
        <li>MAE: {{ stats.oracle_metrics.MAE }}</li>
        <li>MAPE: {{ stats.oracle_metrics.MAPE }}</li>
      </ul>
    </div>
  </section>

  <!-- ğŸ“¤ ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ  -->
  <section class="card mb-8 bg-white dark:bg-gray-800 rounded-xl p-6 shadow">
    <h2 class="text-xl font-semibold mb-4">ğŸ“¤ è©•è­°ä¼šé–‹å‚¬ãƒ•ã‚©ãƒ¼ãƒ </h2>
    <form id="councilForm">
      <div class="grid grid-cols-2 gap-4">
        <input type="number" name="price" placeholder="ç¾ä¾¡æ ¼" class="input" required>
        <input type="number" name="previous_price" placeholder="å‰å›ä¾¡æ ¼" class="input">
        <input type="number" name="volume" placeholder="å‡ºæ¥é«˜" class="input">
        <input type="number" name="spread" placeholder="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰" class="input" step="0.001">
        <input type="number" name="order_block" placeholder="ã‚ªãƒ¼ãƒ€ãƒ¼ãƒ–ãƒ­ãƒƒã‚¯" class="input" step="0.01">
        <input type="number" name="volatility" placeholder="ãƒœãƒ©ãƒ†ã‚£ãƒªãƒ†ã‚£" class="input" step="0.01">
        <input type="text" name="trend_prediction" placeholder="ãƒˆãƒ¬ãƒ³ãƒ‰äºˆæ¸¬ (bullish/bearish)" class="input">
        <input type="number" name="sentiment" placeholder="ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆ(0~1)" class="input" step="0.01">
        <input type="number" name="trend_strength" placeholder="ãƒˆãƒ¬ãƒ³ãƒ‰å¼·åº¦" class="input" step="0.01">
        <input type="number" name="liquidity_ratio" placeholder="æµå‹•æ€§æ¯”ç‡" class="input" step="0.01">
        <input type="number" name="momentum" placeholder="ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ " class="input" step="0.01">
        <input type="number" name="short_interest" placeholder="ã‚·ãƒ§ãƒ¼ãƒˆæ®‹é«˜" class="input" step="0.01">
      </div>
      <button type="submit" class="btn mt-4">ğŸ“£ è©•è­°ä¼šã‚’é–‹å‚¬</button>
    </form>
    <div id="councilResult" class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"></div>
  </section>

  <!-- ğŸ“ˆ Chart.js ã‚°ãƒ©ãƒ• -->
  <section class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow">
    <h2 class="text-xl font-semibold mb-4">ğŸ“Š Oracle äºˆæ¸¬ãƒãƒ£ãƒ¼ãƒˆ</h2>
    <canvas id="forecastChart" height="100"></canvas>
  </section>

  <script>
    // ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
    const toggle = document.getElementById('darkModeToggle');
    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
    });

    // ğŸ“ˆ Chart.jsæç”»
    const forecast = {{ forecast | tojson }};
    const ctx = document.getElementById("forecastChart").getContext("2d");
    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: forecast.map(item => item.date),
        datasets: [
          { label: "äºˆæ¸¬", data: forecast.map(item => item.y_pred), borderWidth: 2 },
          { label: "ä¸‹é™", data: forecast.map(item => item.y_lower), borderWidth: 1, borderDash: [5, 5] },
          { label: "ä¸Šé™", data: forecast.map(item => item.y_upper), borderWidth: 1, borderDash: [5, 5] },
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: false } }
      }
    });

    // ğŸ‘‘ è©•è­°ä¼šãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    const councilForm = document.getElementById("councilForm");
    const resultDiv = document.getElementById("councilResult");

    councilForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(councilForm);
      const marketData = {};
      formData.forEach((v, k) => { marketData[k] = isNaN(v) ? v : Number(v); });

      resultDiv.innerHTML = "â³ è©•è­°ä¼šé–‹å‚¬ä¸­â€¦";

      const res = await fetch("/king/hold-council", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(marketData)
      });

      if (res.ok) {
        const data = await res.json();
        resultDiv.innerHTML = `
          <strong>ğŸ‘‘ ç‹ã®åˆ¤æ–­:</strong> ${data.final_decision}<br/>
          <strong>ğŸ“˜ Veritas:</strong> ${JSON.stringify(data.veritas)}<br/>
          <strong>ğŸ“ˆ Prometheus:</strong> ${JSON.stringify(data.prometheus_forecast)}<br/>
          <strong>âš™ Aurus:</strong> ${data.aurus}<br/>
          <strong>ğŸŒŠ Levia:</strong> ${data.levia}<br/>
          <strong>ğŸ›¡ Noctus:</strong> ${data.noctus}
        `;
      } else {
        resultDiv.innerHTML = "âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
      }
    });
  </script>

  <style>
    .input {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 100%;
    }
    .btn {
      background: #4b7bec;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn:hover {
      background: #3867d6;
    }
  </style>
</body>
</html>
