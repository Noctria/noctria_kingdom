{% extends "base_hud.html" %}

{% block title %}ğŸ“„ æˆ¦ç•¥è©³ç´° - {{ strategy.strategy }}{% endblock %}

{% block header_icon %}<i class="fas fa-scroll"></i>{% endblock %}
{% block header_title %}æˆ¦ç•¥è©³ç´°ï¼š{{ strategy.strategy }}{% endblock %}
{% block header_nav %}
<a href="/strategies" class="nav-item-back">
  <i class="fas fa-arrow-left"></i><span>æˆ¦ç•¥ä¸€è¦§</span>
</a>
{% endblock %}

{% block content %}
<section class="hud-panel">
  <h2 class="panel-title">ğŸ“Š æ¦‚è¦</h2>
  <table class="hud-table">
    <tr><th>å‹ç‡</th><td>{{ strategy.win_rate or "â€•" }}%</td></tr>
    <tr><th>å–å¼•æ•°</th><td>{{ strategy.num_trades or "â€•" }}</td></tr>
    <tr><th>æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³</th><td>{{ strategy.max_drawdown or "â€•" }}</td></tr>
    <tr>
      <th>ã‚¿ã‚°</th>
      <td>
        {% for tag in strategy.tags %}
          <span class="hud-tag">{{ tag }}</span>
        {% endfor %}
      </td>
    </tr>
  </table>
</section>

<section class="hud-panel">
  <h2 class="panel-title">ğŸ“ˆ è©•ä¾¡ã‚°ãƒ©ãƒ•ï¼ˆä»–æˆ¦ç•¥ã¨æ¯”è¼ƒï¼‰</h2>
  <div class="chart-container-half">
    <canvas id="comparisonChart"></canvas>
  </div>
</section>

<section class="hud-panel">
  <h2 class="panel-title">ğŸ§  ãƒ­ã‚¸ãƒƒã‚¯èª¬æ˜</h2>
  <div class="description-box">
    {{ strategy.description or "èª¬æ˜ãŒã‚ã‚Šã¾ã›ã‚“ã€‚" }}
  </div>
</section>

<div style="margin-top: 2rem; display: flex; gap: 1rem;">
  <a class="hud-btn" href="/strategies/view?name={{ strategy.strategy }}.py">ğŸ“œ ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹</a>
  <a class="hud-btn" href="/strategies">â† æˆ¦ç•¥ä¸€è¦§ã«æˆ»ã‚‹</a>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = ["å‹ç‡", "å–å¼•æ•°", "æœ€å¤§DD"];
  const datasets = [
    {
      label: "{{ strategy.strategy }}",
      data: [
        {{ strategy.win_rate or 0 }},
        {{ strategy.num_trades or 0 }},
        {{ strategy.max_drawdown or 0 }}
      ],
      backgroundColor: "rgba(0, 229, 255, 0.6)"
    },
    {% for s in related_strategies %}
    {
      label: "{{ s.strategy }}",
      data: [
        {{ s.win_rate or 0 }},
        {{ s.num_trades or 0 }},
        {{ s.max_drawdown or 0 }}
      ],
      backgroundColor: "rgba({{ 60 + loop.index0 * 30 }}, 150, 255, 0.4)"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ];

  const ctx = document.getElementById('comparisonChart');
  new Chart(ctx, {
    type: 'bar',
    data: { labels, datasets },
    options: {
      responsive: true,
      plugins: {
        legend: {
          labels: {
            color: '#cceeff',
            font: {
              family: 'Roboto Mono',
              size: 14
            }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 30, 60, 0.8)',
          borderColor: '#00e5ff',
          borderWidth: 1
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { color: '#a8b2d1' },
          grid: { color: 'rgba(0, 229, 255, 0.2)' }
        },
        x: {
          ticks: { color: '#a8b2d1' },
          grid: { color: 'rgba(0, 229, 255, 0.05)' }
        }
      }
    }
  });
</script>
{% endblock %}
