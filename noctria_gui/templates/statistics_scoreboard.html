<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>📊 タグ統合スコアボード</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f5f5f5;
      padding: 2rem;
    }
    h1 {
      color: #222;
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      background: #fff;
      border-collapse: collapse;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.75rem;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #e9f2fb;
      cursor: pointer;
    }
    tr:hover {
      background-color: #f1f7ff;
    }
    .green {
      background-color: #d0f0d0;
    }
    .red {
      background-color: #f8d0d0;
    }
    .gold {
      background-color: #fff5cc;
    }
    a {
      display: inline-block;
      margin-top: 2rem;
      text-decoration: none;
      color: #007acc;
    }
  </style>
</head>
<body>
  <h1>📊 タグ統合スコアボード</h1>

  <table id="scoreboard">
    <thead>
      <tr>
        <th onclick="sortTable(0)">タグ</th>
        <th onclick="sortTable(1)">勝率（%）</th>
        <th onclick="sortTable(2)">最大DD（%）</th>
        <th onclick="sortTable(3)">取引数</th>
        <th onclick="sortTable(4)">昇格率</th>
      </tr>
    </thead>
    <tbody>
      {% for row in tag_stats %}
      <tr>
        <td>{{ row.type }}</td>
        <td class="{{ 'green' if row.win_rate >= 70 else '' }}">{{ row.win_rate or '―' }}</td>
        <td class="{{ 'red' if row.max_drawdown >= 10 else '' }}">{{ row.max_drawdown or '―' }}</td>
        <td>{{ row.num_trades or '―' }}</td>
        <td class="{{ 'gold' if row.promotion_rate >= 0.5 else '' }}">{{ row.promotion_rate or '―' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="/dashboard">← ダッシュボードへ戻る</a>

  <script>
    function sortTable(colIndex) {
      const table = document.getElementById("scoreboard");
      const rows = Array.from(table.rows).slice(1);
      const isNumeric = colIndex > 0;
      const sorted = rows.sort((a, b) => {
        const valA = a.cells[colIndex].innerText;
        const valB = b.cells[colIndex].innerText;
        if (isNumeric) {
          return parseFloat(valB) - parseFloat(valA);
        }
        return valA.localeCompare(valB);
      });
      for (const row of sorted) {
        table.tBodies[0].appendChild(row);
      }
    }
  </script>
</body>
</html>
