{% extends "base_hud.html" %}

{% block title %}üìÑ Strategy Detail - Noctria Kingdom HUD{% endblock %}

{% block header_icon %}<i class="fas fa-file-invoice"></i>{% endblock %}
{% block header_title %}STRATEGY DETAIL{% endblock %}
{% block header_nav_href %}/act-history{% endblock %}
{% block header_nav_text %}Back{% endblock %}

{% block content %}
<!-- Main Detail Panel -->
<main class="hud-panel detail-panel" style="display:flex; flex-direction: column; gap:1.5rem;">
    <h2 class="panel-title">STRATEGY: {{ log.strategy }}</h2>

    <div class="detail-grid" style="display:flex; gap:2rem; flex-wrap: wrap;">
        <!-- Left Column -->
        <div class="detail-info" style="flex:1 1 320px; min-width:300px;">
            <dl class="hud-dl" style="display:grid; grid-template-columns: max-content 1fr; row-gap:0.8rem; column-gap:1rem;">
                <div>
                    <dt>Symbol</dt>
                    <dd>{{ log.symbol }}</dd>
                </div>
                <div>
                    <dt>Promoted At</dt>
                    <dd>{{ log.promoted_at or log.timestamp }}</dd>
                </div>
                <div>
                    <dt>Win Rate</dt>
                    <dd class="text-green">
                        {{ '%.2f'|format(log.win_rate) if log.win_rate is not none else '-' }}%
                    </dd>
                </div>
                <div>
                    <dt>Max Drawdown</dt>
                    <dd class="text-magenta">
                        {{ '%.2f'|format(log.max_drawdown) if log.max_drawdown is not none else '-' }}%
                    </dd>
                </div>
                <div>
                    <dt>Score</dt>
                    <dd class="text-cyan">
                        {{ '%.2f'|format(log.score_mean) if log.score_mean is not none else '-' }}
                    </dd>
                </div>
                <div>
                    <dt>Pushed</dt>
                    <dd>{{ '‚úÖ Pushed' if log.pushed else '‚ùå Not Pushed' }}</dd>
                </div>
                <div>
                    <dt>Filename</dt>
                    <dd>{{ log.filename }}</dd>
                </div>
                <div>
                    <dt>Tags</dt>
                    <dd>
                        {% if log.tags %}
                            {% for t in log.tags %}
                                <span class="hud-tag" style="display:inline-block; background:var(--glow-primary); color: var(--bg-color); padding:0.2rem 0.6rem; border-radius:0.75rem; margin-right:0.4rem; font-weight:700;">{{ t }}</span>
                            {% endfor %}
                        {% else %}<span>-</span>{% endif %}
                    </dd>
                </div>
            </dl>
        </div>

        <!-- Right Column -->
        <div class="detail-actions" style="flex:1 1 180px; min-width:180px; display:flex; flex-direction: column; gap:1rem;">
            <h3 class="actions-title panel-title" style="font-size:1.1rem; color: var(--text-color-normal); filter: drop-shadow(0 0 8px var(--glow-primary)); margin-bottom:0.5rem;">OPERATIONS</h3>
            <form method="post" action="/act-history/repush">
                <input type="hidden" name="strategy_name" value="{{ log.strategy }}">
                <button class="hud-button" type="submit" style="width:100%; display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                    <i class="fas fa-redo"></i> ÂÜçPushÂèØ„Å´„Åô„Çã
                </button>
            </form>
            <form method="post" action="/act-history/reevaluate">
                <input type="hidden" name="strategy_name" value="{{ log.strategy }}">
                <button class="hud-button" type="submit" style="width:100%; display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                    <i class="fas fa-cogs"></i> ÂÜçË©ï‰æ°„Åô„Çã
                </button>
            </form>
        </div>
    </div>
</main>

<!-- Raw JSON Section -->
<section class="hud-panel log-content-panel" style="overflow-x:auto; white-space: pre-wrap; font-family: 'Roboto Mono', monospace; font-size:0.85rem; max-height: 320px;">
    <h2 class="panel-title"><i class="fas fa-code"></i> RAW LOG DATA</h2>
    <pre class="log-json" style="color: var(--text-color-light); background: var(--bg-color); padding: 1rem; border-radius: 12px;">{{ log.json_text }}</pre>
</section>
{% endblock %}
