{% extends "base_hud.html" %}

{% block title %}👑 評議会ログ履歴 - Noctria Kingdom HUD{% endblock %}
{% block header_icon %}<i class="fas fa-crown"></i>{% endblock %}
{% block header_title %}評議会ログ履歴{% endblock %}
{% block header_nav_href %}/dashboard{% endblock %}
{% block header_nav_text %}DASHBOARD{% endblock %}

{% block content %}
{% if error %}
  <div class="hud-panel" style="border: 1px solid red; background: #ffe6e6; color: darkred;">
    ⚠️ 読み込みエラー: {{ error }}
  </div>
{% endif %}

<section class="hud-panel log-panel">
  {% if logs %}
    <div class="table-wrapper" style="max-height: 600px; overflow-y: auto;">
      <table class="hud-table">
        <thead>
          <tr>
            <th>🕒 日時</th>
            <th>👑 王命</th>
            <th>🗡️ Aurus</th>
            <th>🌊 Levia</th>
            <th>🛡️ Noctus</th>
            <th>📝 詳細</th>
          </tr>
        </thead>
        <tbody>
          {% for log in logs %}
          {% set r = log.result or log.decision or {} %}
          <tr>
            <td>{{ log.timestamp | default("-") }}</td>
            <td><strong>{{ r.final_decision | default("-") }}</strong></td>
            <td>
              {% if r.assessments and r.assessments.aurus_proposal %}
                {{ r.assessments.aurus_proposal.signal | default("-") }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if r.assessments and r.assessments.levia_proposal %}
                {{ r.assessments.levia_proposal.signal | default("-") }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if r.assessments and r.assessments.noctus_assessment %}
                {{ r.assessments.noctus_assessment.decision | default("-") }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <details>
                <summary>全文</summary>
                <pre style="font-size: 11px;">{{ r | tojson(indent=2) }}</pre>
              </details>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p style="text-align: center;">📭 評議会の履歴はまだ存在しません。</p>
  {% endif %}
</section>
{% endblock %}
