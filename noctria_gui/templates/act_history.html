<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Noctria Kingdom - æ¡ç”¨æˆ¦ç•¥ãƒ­ã‚°</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f0f0f5;
      padding: 2rem;
    }
    h1 {
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background-color: #fff;
    }
    th, td {
      padding: 0.6rem;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #e0e0e0;
    }
    .btn {
      padding: 0.3rem 0.6rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .btn:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .filters {
      margin-bottom: 1rem;
    }
    .filters form, .filters .links {
      display: inline-block;
      margin-right: 2rem;
    }
    .filters input[type="text"] {
      padding: 0.3rem;
    }
    .pushed-true {
      color: green;
      font-weight: bold;
    }
    .pushed-false {
      color: red;
      font-weight: bold;
    }
    .forced-true {
      background-color: #fff3cd;
    }
  </style>
</head>
<body>
  <h1>ğŸ“œ æ¡ç”¨æˆ¦ç•¥ãƒ­ã‚° - Actå±¥æ­´</h1>

  <div class="filters">
    <form method="get" action="/act-history">
      <input type="text" name="strategy" placeholder="æˆ¦ç•¥åã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼" value="{{ strategy or '' }}">
      <select name="pushed">
        <option value="">PushçŠ¶æ…‹ã‚’é¸æŠ</option>
        <option value="true" {% if pushed == 'true' %}selected{% endif %}>âœ… Pushed</option>
        <option value="false" {% if pushed == 'false' %}selected{% endif %}>âŒ Not Pushed</option>
      </select>
      <select name="sort_by">
        <option value="timestamp" {% if sort_by == 'timestamp' %}selected{% endif %}>æ—¥æ™‚</option>
        <option value="strategy" {% if sort_by == 'strategy' %}selected{% endif %}>æˆ¦ç•¥å</option>
      </select>
      <select name="order">
        <option value="desc" {% if order == 'desc' %}selected{% endif %}>é™é †</option>
        <option value="asc" {% if order == 'asc' %}selected{% endif %}>æ˜‡é †</option>
      </select>
      <button class="btn" type="submit">é©ç”¨</button>
    </form>

    <div class="links">
      <a href="/act-history">ğŸ”„ å…¨è¡¨ç¤º</a> |
      <a href="/act-history?pushed=false">ğŸ•³ï¸ æœªPushã®ã¿</a>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>æ—¥æ™‚</th>
        <th>æˆ¦ç•¥å</th>
        <th>è©•ä¾¡ã‚¹ã‚³ã‚¢</th>
        <th>æ˜‡æ ¼ç†ç”±</th>
        <th>PushçŠ¶æ…‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr class="{% if log.forced %}forced-true{% endif %}">
        <td>{{ log.timestamp }}</td>
        <td>{{ log.strategy }}</td>
        <td>
          {% for key, val in log.score.items() %}
            {{ key }}: {{ val }}<br>
          {% endfor %}
        </td>
        <td>{{ log.reason }}</td>
        <td class="pushed-{{ log.pushed }}">
          {% if log.pushed %}âœ… Pushed{% else %}âŒ Not Pushed{% endif %}
        </td>
        <td>
          {% if not log.pushed %}
          <form method="post" action="/act-history/push" style="display:inline;">
            <input type="hidden" name="filename" value="{{ log.__filename }}">
            <button class="btn" type="submit">ğŸ“¤ Push</button>
          </form>
          {% endif %}
          <form method="post" action="/act-history/force-record" style="display:inline;">
            <input type="hidden" name="strategy" value="{{ log.strategy }}">
            <input type="hidden" name="score" value='{{ log.score | tojson }}'>
            <input type="hidden" name="reason" value="å†è©•ä¾¡ã«ã‚ˆã‚Šå¼·åˆ¶æ˜‡æ ¼">
            <button class="btn" type="submit">âš ï¸ å†è¨˜éŒ²</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
