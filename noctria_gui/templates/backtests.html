<!-- noctria_gui/templates/backtests.html -->
{% extends "base_hud.html" %}

{% block title %}🧪 Backtest Results - Noctria Kingdom{% endblock %}
{% block header_icon %}<i class="fas fa-flask"></i>{% endblock %}
{% block header_title %}BACKTEST RESULTS{% endblock %}
{% block header_nav_href %}/dashboard{% endblock %}
{% block header_nav_text %}DASHBOARD{% endblock %}

{% block content %}
<div class="hud-panel">
  <h2 class="hud-heading">Recent Backtests</h2>
  <p class="hud-muted">
    成果物は Airflow の scheduler コンテナから収集されます。リンクは
    <code>/backtests/api/...</code> に統一しました。
  </p>

  {% if runs %}
  <table class="hud-table">
    <thead>
      <tr>
        <th>Run ID</th>
        <th>Started</th>
        <th>Report</th>
        <th>JSON</th>
        <th>CSV</th>
        <th>Conf</th>
      </tr>
    </thead>
    <tbody>
      {% for run in runs %}
      <tr>
        <td style="max-width: 520px; overflow-wrap:anywhere;"><code>{{ run.run_id }}</code></td>
        <td>{{ run.started or "-" }}</td>
        <td>
          <a href="/backtests/{{ run.run_id }}/report" target="_blank" rel="noopener">HTML</a>
        </td>
        <td>
          <a href="/backtests/api/{{ run.run_id }}/json" target="_blank" rel="noopener">result.json</a>
        </td>
        <td>
          <a href="/backtests/api/{{ run.run_id }}/artifact/result.csv" target="_blank" rel="noopener">result.csv</a>
        </td>
        <td>
          <a href="/backtests/api/{{ run.run_id }}/conf" target="_blank" rel="noopener">conf.json</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="hud-muted">まだ成果物はありません。</p>
  {% endif %}

  <div class="hud-actions" style="margin-top:1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
    <a class="btn btn--ghost" href="/backtests/api/latest" target="_blank" rel="noopener">
      <i class="fas fa-bolt"></i> 最新 run_id (JSON)
    </a>
    <a class="btn btn--ghost" href="/backtests/" rel="noopener">
      <i class="fas fa-sync"></i> 再読込
    </a>
  </div>
</div>
{% endblock %}
