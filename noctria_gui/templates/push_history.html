{% extends "base_hud.html" %}

{% block title %}ğŸ“¤ Pushå±¥æ­´ - Noctria Kingdom{% endblock %}
{% block header_icon %}<i class="fas fa-upload"></i>{% endblock %}
{% block header_title %}PUSH HISTORY{% endblock %}
{% block header_nav_href %}/dashboard{% endblock %}
{% block header_nav_text %}â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸æˆ»ã‚‹{% endblock %}

{% block content %}
<!-- ğŸš€ Pushãƒˆãƒªã‚¬ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ  -->
<section class="hud-panel">
  <h2 class="panel-title">ğŸš€ æˆ¦ç•¥ã‚’GitHubã¸Push</h2>
  <form method="post" action="/push/trigger" class="filter-form">
    <label class="hud-label">
      æˆ¦ç•¥åï¼ˆä¾‹: Aurora_VX2ï¼‰:
      <input type="text" name="strategy_name" required placeholder="ä¾‹: Aurora_VX2" class="hud-input">
    </label>
    <button type="submit" class="hud-button">ğŸš€ Pushå®Ÿè¡Œ</button>
  </form>
</section>

<!-- ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UI -->
<section class="hud-panel">
  <form method="get" action="/push/history" class="filter-form">
    <label class="hud-label">æˆ¦ç•¥å
      <input type="text" name="strategy" value="{{ filters.strategy }}" class="hud-input">
    </label>
    <label class="hud-label">ã‚¿ã‚°
      <input type="text" name="tag" value="{{ filters.tag }}" class="hud-input">
    </label>
    <label class="hud-label">é–‹å§‹æ—¥
      <input type="date" name="start_date" value="{{ filters.start_date }}" class="hud-input">
    </label>
    <label class="hud-label">çµ‚äº†æ—¥
      <input type="date" name="end_date" value="{{ filters.end_date }}" class="hud-input">
    </label>
    <label class="hud-label">ä¸¦ã³é †
      <select name="sort" class="hud-select">
        <option value="desc" {% if filters.sort == 'desc' %}selected{% endif %}>æ–°ã—ã„é †</option>
        <option value="asc" {% if filters.sort == 'asc' %}selected{% endif %}>å¤ã„é †</option>
      </select>
    </label>
    <button type="submit" class="hud-button">ğŸ” æ¤œç´¢</button>
    <a class="hud-button hud-button-secondary"
       href="/push/export?strategy={{ filters.strategy }}&tag={{ filters.tag }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}">
      ğŸ“¤ CSVå‡ºåŠ›
    </a>
  </form>
</section>

<!-- ğŸ“‹ Pushãƒ­ã‚°ä¸€è¦§ -->
<section class="hud-panel">
  <h2 class="panel-title">Pushãƒ­ã‚°ä¸€è¦§</h2>
  {% if logs %}
  <table class="hud-table">
    <thead>
      <tr>
        <th>æ—¥æ™‚</th>
        <th>æˆ¦ç•¥å</th>
        <th>ã‚¿ã‚°</th>
        <th>æ‹…å½“è€…</th>
        <th>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</th>
        <th>è©³ç´°</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td>{{ log.timestamp }}</td>
        <td>{{ log.strategy }}</td>
        <td>{{ log.tag or "-" }}</td>
        <td>{{ log.pushed_by or "-" }}</td>
        <td>{{ log.message or "-" }}</td>
        <td><a href="/push/detail?timestamp={{ log.timestamp }}" class="hud-button">ğŸ” è©³ç´°</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="hud-text-muted">Pushå±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}

  <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
  {% if total_pages > 1 %}
  <nav style="margin-top: 1rem;">
    {% for p in range(1, total_pages + 1) %}
      {% if p == current_page %}
        <strong class="hud-pagination-current">[{{ p }}]</strong>
      {% else %}
        <a href="?page={{ p }}&strategy={{ filters.strategy }}&tag={{ filters.tag }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}&sort={{ filters.sort }}" class="hud-pagination-link">
          {{ p }}
        </a>
      {% endif %}
    {% endfor %}
  </nav>
  {% endif %}
</section>
{% endblock %}
