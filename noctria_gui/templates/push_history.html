<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>📤 Push履歴 - Noctria Kingdom</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h1>📤 Veritas Push履歴一覧</h1>

  <!-- 🔍 フィルターUI -->
  <form method="get" action="/push-history" class="filter card">
    <label>
      戦略名
      <input type="text" name="strategy" value="{{ filters.strategy }}">
    </label>
    <label>
      タグ
      <input type="text" name="tag" value="{{ filters.tag }}">
    </label>
    <label>
      開始日
      <input type="date" name="start_date" value="{{ filters.start_date }}">
    </label>
    <label>
      終了日
      <input type="date" name="end_date" value="{{ filters.end_date }}">
    </label>
    <label>
      並び順
      <select name="sort">
        <option value="desc" {% if filters.sort == 'desc' %}selected{% endif %}>新しい順</option>
        <option value="asc" {% if filters.sort == 'asc' %}selected{% endif %}>古い順</option>
      </select>
    </label>
    <button type="submit" class="btn">🔍 検索</button>
    <a class="btn"
       href="/push-history/export?strategy={{ filters.strategy }}&tag={{ filters.tag }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}">
      📤 CSV出力
    </a>
  </form>

  <!-- 📋 Pushログ一覧 -->
  <table class="table">
    <thead>
      <tr>
        <th>日時</th>
        <th>戦略名</th>
        <th>タグ</th>
        <th>担当者</th>
        <th>メッセージ</th>
        <th>詳細</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td>{{ log.timestamp }}</td>
        <td>{{ log.strategy }}</td>
        <td>{{ log.tag or "-" }}</td>
        <td>{{ log.pushed_by or "-" }}</td>
        <td>{{ log.message or "-" }}</td>
        <td>
          <a href="/push-history/detail?timestamp={{ log.timestamp }}" class="btn">🔍 詳細</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- 📄 ページネーション -->
  {% if total_pages > 1 %}
  <div style="margin-top: 1rem;">
    {% for p in range(1, total_pages + 1) %}
      {% if p == current_page %}
        <strong style="margin: 0 4px;">[{{ p }}]</strong>
      {% else %}
        <a href="?page={{ p }}&strategy={{ filters.strategy }}&tag={{ filters.tag }}&start_date={{ filters.start_date }}&end_date={{ filters.end_date }}&sort={{ filters.sort }}" style="margin: 0 4px;">
          {{ p }}
        </a>
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</body>
</html>
