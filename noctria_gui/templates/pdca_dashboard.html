<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Noctria Kingdom - PDCA ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f4f4f4;
      padding: 2rem;
    }
    h1 {
      color: #222;
      margin-bottom: 1rem;
    }
    form.filter-form {
      background-color: #fff;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    form.filter-form input,
    form.filter-form select,
    form.filter-form button {
      padding: 0.5rem;
      font-size: 0.9rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 0.6rem;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #333;
      color: white;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    button {
      padding: 0.4rem 0.8rem;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #004999;
    }
    pre {
      text-align: left;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      padding: 1rem;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    dialog {
      border: none;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      max-width: 700px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“œ PDCA å®Ÿè¡Œå±¥æ­´ï¼ˆVeritas Kingdomï¼‰</h1>

  <!-- ğŸ” ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UI -->
  <form class="filter-form" method="get" action="/pdca">
    <input type="text" name="strategy" placeholder="æˆ¦ç•¥å" value="{{ filters.strategy }}">
    <input type="text" name="symbol" placeholder="é€šè²¨ (ä¾‹: USDJPY)" value="{{ filters.symbol }}">
    <select name="signal">
      <option value="">ã‚·ã‚°ãƒŠãƒ«</option>
      <option value="BUY" {% if filters.signal == 'BUY' %}selected{% endif %}>BUY</option>
      <option value="SELL" {% if filters.signal == 'SELL' %}selected{% endif %}>SELL</option>
    </select>
    <input type="date" name="date_from" value="{{ filters.date_from }}">
    <input type="date" name="date_to" value="{{ filters.date_to }}">
    <button type="submit">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>ğŸ“… æ™‚åˆ»</th>
        <th>ğŸ§  æˆ¦ç•¥</th>
        <th>ğŸ’¡ ã‚·ã‚°ãƒŠãƒ«</th>
        <th>ğŸ’± é€šè²¨</th>
        <th>ğŸ¯ ãƒ­ãƒƒãƒˆ</th>
        <th>ğŸ¯ TP/SL</th>
        <th>ğŸ“ˆ å‹ç‡</th>
        <th>ğŸ“‰ DD</th>
        <th>ğŸ” å›æ•°</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td>{{ log.timestamp }}</td>
        <td>{{ log.strategy }}</td>
        <td>{{ log.signal }}</td>
        <td>{{ log.symbol }}</td>
        <td>{{ log.lot }}</td>
        <td>{{ log.tp }}/{{ log.sl }}</td>
        <td>
          {% if log.win_rate is not none %}
            {{ '%.1f' | format(log.win_rate * 100) }}%
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          {% if log.max_dd is not none %}
            {{ '%.1f' | format(log.max_dd * 100) }}%
          {% else %}
            -
          {% endif %}
        </td>
        <td>{{ log.trades or "-" }}</td>
        <td>
          <button onclick="showModal('modal_{{ loop.index }}')">è©³ç´°</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- ğŸ” ãƒ¢ãƒ¼ãƒ€ãƒ«ç¾¤ -->
  {% for log in logs %}
  <dialog id="modal_{{ loop.index }}">
    <h3>ğŸ“„ è©³ç´°ãƒ­ã‚°ï¼ˆ{{ log.filename }}ï¼‰</h3>
    <pre>{{ log.json_text }}</pre>
    <form method="post" action="/pdca/replay">
      <input type="hidden" name="log_path" value="{{ log.path }}">
      <button type="submit">ã“ã®å‘½ä»¤ã§å†å®Ÿè¡Œ</button>
    </form>
    <button onclick="closeModal('modal_{{ loop.index }}')">é–‰ã˜ã‚‹</button>
  </dialog>
  {% endfor %}

  <script>
    function showModal(id) {
      document.getElementById(id).showModal();
    }
    function closeModal(id) {
      document.getElementById(id).close();
    }
  </script>
</body>
</html>
