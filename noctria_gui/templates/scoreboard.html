<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>üìä Tag Heatmap - Noctria Kingdom HUD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Fonts & Font Awesome -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- HUD„Çπ„Çø„Ç§„É´ -->
    <link rel="stylesheet" href="/static/hud_style.css" />
</head>
<body>

    <div class="hud-container-simple">
        <!-- Header -->
        <header class="hud-panel header">
            <h1 class="hud-title"><i class="fas fa-th"></i> TAG STRATEGY HEATMAP</h1>
            <a href="/dashboard" class="nav-item-back"><i class="fas fa-tachometer-alt"></i><span>DASHBOARD</span></a>
        </header>

        <!-- Filter Panel -->
        <section class="hud-panel filter-panel">
            <h2 class="panel-title"><i class="fas fa-filter"></i> FILTER & SEARCH</h2>
            <form method="get" class="filter-form">
                <input type="date" name="from" value="{{ filter.from }}">
                <input type="date" name="to" value="{{ filter.to }}">
                <input type="text" name="tag" placeholder="Tag name..." value="{{ filter.tag }}">
                <button type="submit" class="hud-btn"><i class="fas fa-check"></i> APPLY</button>
            </form>
        </section>

        <!-- Heatmap Panel -->
        <main class="hud-panel log-panel">
            <div class="panel-header-flex">
                <h2 class="panel-title">HEATMAP DATA</h2>
                <a class="hud-btn-small" href="/statistics/heatmap/export?from={{ filter.from }}&to={{ filter.to }}&tag={{ filter.tag }}">
                    <i class="fas fa-file-csv"></i> CSV„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                </a>
            </div>
            <div class="table-wrapper">
                <table class="hud-table heatmap-table">
                    <thead>
                        <tr>
                            <th>üè∑ „Çø„Ç∞</th>
                            <th><i class="fas fa-hashtag"></i> ‰ª∂Êï∞</th>
                            <th><i class="fas fa-chart-line"></i> Âπ≥ÂùáÂãùÁéá (%)</th>
                            <th><i class="fas fa-chart-area"></i> ÊúÄÂ§ßDD (%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tag, info in data.items() %}
                        <tr>
                            <td class="tag-name-cell">{{ tag }}</td>
                            <td>{{ info.count }}</td>
                            <td class="heatmap-cell" style="--value: {{ info.avg_win if info.avg_win is not none else 0 }}; --max: 100; --color: var(--accent-color-1);">
                                {{ '%.2f'|format(info.avg_win) if info.avg_win is not none else '-' }}
                            </td>
                            <td class="heatmap-cell" style="--value: {{ info.avg_dd if info.avg_dd is not none else 0 }}; --max: 30; --color: var(--accent-color-2);">
                                {{ '%.2f'|format(info.avg_dd) if info.avg_dd is not none else '-' }}
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="4" style="text-align: center;">Ë©≤ÂΩì„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>

</body>
</html>
