# ================================
# ğŸŒª Noctria Kingdom: Airflow Dockerfile
# ãƒ™ãƒ¼ã‚¹: Apache Airflow 2.7.3 + Python 3.10
# ================================

FROM apache/airflow:2.7.3-python3.10

# ğŸ”¹ ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆãƒ­ã‚°éãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚° / ãƒ‘ã‚¹ / Airflowæ§‹æˆãƒ«ãƒ¼ãƒˆï¼‰
ENV PYTHONUNBUFFERED=1 \
    PYTHONPATH=/noctria_kingdom \
    AIRFLOW_HOME=/noctria_kingdom/airflow_docker

# ğŸ”¹ ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆCLIå®Ÿè¡Œã®åŸºæº–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
WORKDIR ${AIRFLOW_HOME}

# ğŸ”¹ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã¨åˆ¶ç´„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼
COPY airflow_docker/docker/requirements_airflow.txt /requirements_airflow.txt
COPY airflow_docker/docker/requirements_extra.txt /requirements_extra.txt
COPY airflow_docker/docker/constraints.txt /tmp/constraints.txt

# ğŸ”¹ Airflowæœ¬ä½“ã‚„å‘¨è¾ºãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’å…ˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN pip install --upgrade pip \
 && pip install --no-cache-dir -r /requirements_airflow.txt --constraint /tmp/constraints.txt

# ğŸ”¹ æ·±å±¤å­¦ç¿’ãƒ»å¼·åŒ–å­¦ç¿’ãƒ»å¤–éƒ¨ç³»ãªã©åˆ¶ç´„å¤–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¾Œã‹ã‚‰
RUN pip install --no-cache-dir -r /requirements_extra.txt
