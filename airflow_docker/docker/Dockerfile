# ================================
# ğŸŒª Noctria Kingdom: Airflow Dockerfile (v2.1)
# ================================

FROM apache/airflow:2.7.3-python3.10

# ğŸ”¹ ãƒ­ã‚°éãƒãƒƒãƒ•ã‚¡åŒ– / çµ±ä¸€ãƒ«ãƒ¼ãƒˆ
ENV PYTHONUNBUFFERED=1 \
    PYTHONPATH=/opt/airflow \
    AIRFLOW_HOME=/opt/airflow

# ğŸ”¹ ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
WORKDIR ${AIRFLOW_HOME}

# ğŸ”¹ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼ï¼ˆbuild contextãŒ airflow_docker/ ã®å ´åˆï¼‰
COPY docker/requirements_airflow.txt /requirements_airflow.txt
COPY docker/requirements_extra.txt /requirements_extra.txt
COPY docker/constraints.txt /tmp/constraints.txt

# ğŸ”¹ Airflow æœ¬ä½“ + å‘¨è¾ºãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
RUN set -ex \
 && pip install --upgrade pip \
 && pip install --no-cache-dir -r /requirements_airflow.txt --constraint /tmp/constraints.txt

# ğŸ”¹ å¤–éƒ¨ãƒ»é‡ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆåˆ¶ç´„å¤–ï¼‰
RUN pip install --no-cache-dir -r /requirements_extra.txt
