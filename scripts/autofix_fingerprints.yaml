- id: missing_yfinance
  when_stdout_regex: "ImportError: yfinance"
  guide: "オフライン環境では yfinance をスタブするか、collector をモックしてください。"
  extra_files:
    - "src/plan_data/collector.py"

- id: statsmodels_missing
  when_stdout_regex: "ModuleNotFoundError: No module named 'statsmodels'"
  guide: "RiskManagerの時系列平滑はスタブしても良い。テストが求める最低限に揃える。"

- id: obs_plan_runs_missing
  when_stdout_regex: "obs_plan_runs.*(not increase|0 ==)"
  guide: >
    minidemo 実行後に観測DBへ1件INSERT。src/veritas/record_act_log.py にヘルパを作り、
    plan_to_all_minidemo.main() の最後で呼ぶ。tests は触らない。
  prefer_fix_in: "src"
  extra_files:
    - "src/plan_data/plan_to_all_minidemo.py"
    - "src/veritas/record_act_log.py"

- id: decide_needs_proposals
  when_stdout_regex: "decide\\(\\) missing .* 'proposals'|TypeError: .*decide"
  guide: >
    DecisionEngine.decide(context, proposals=None) にし、None を [] として扱う。
  prefer_fix_in: "src"
  extra_files:
    - "src/decision/decision_engine.py"


- id: ruff_format_graveyard
  when_stdout_regex: "Failed to parse .*_graveyard/.* Expected one or more symbol names after import"
  guide: |
    pre-commit の ruff / ruff-format フックで _graveyard/ 配下を除外して下さい。
    例:
      - repo: https://github.com/astral-sh/ruff-pre-commit
        rev: v0.6.5
        hooks:
          - id: ruff
            args: [--fix, --force-exclude]
            exclude: '(^|/)_graveyard/'
          - id: ruff-format
            args: [--force-exclude]
            exclude: '(^|/)_graveyard/'
  prefer_fix_in: ".pre-commit-config.yaml"
  extra_files:
    - ".pre-commit-config.yaml"

- id: precommit_ruff_format
  when_stdout_regex: "(?i)(pre-commit|ruff-format|ruff )"
  guide: |
    pre-commit の失敗。まず .pre-commit-config.yaml を直して下さい。
    例: 古い産廃を除外
      exclude: '(^|/)_graveyard/'
  prefer_fix_in: ".pre-commit-config.yaml"
