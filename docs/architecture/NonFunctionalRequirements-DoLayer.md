# Non-Functional Requirements — Do Layer
**Last Updated:** 2025-08-24 (JST)  
**Owner:** Platform / Do-Layer

---

## 0. 目的
Do 層の**非機能要求（NFR）**を明文化し、設計・運用・容量計画の基準とする。

---

## 1. 信頼性・可用性
- 可用性 SLO（30日）: **≥ 99.5%**
- データ耐久性: idempo_ledger は **単一 AZ 障害を許容**（永続ボリューム + 定期バックアップ）
- バックアップ: 1h スナップショット / 7日保持

---

## 2. 性能
- レイテンシ: `/do/order` P95 **≤ 300ms**（IOC/内部実装での目安）
- スループット: 60 RPM（初期）→ 300 RPM（拡張）を無停止で対応可能
- コールドスタート: ≤ 2s（ワーカーは常駐）

---

## 3. スケーラビリティ
- 水平分散: API Pod 水平スケール、DB は Read Replica（将来 Outbox P1 導入後に分離検討）
- キューイング: P1 の Outbox ワーカー並列度で送信ピークを吸収

---

## 4. 運用
- デプロイ: ローリング（同一 `Idempotency-Key` の再送で安全にリトライ可能）
- コンフィグ: `.env` / Secrets Manager、一部は Feature Flag 化
- 監視: `DoLayer-Metrics.md` に準拠

---

## 5. セキュリティ
- Secrets: `Secrets-Policy.md` に準拠
- 入力検証: 422 で早期遮断、PII ログ禁止

---

## 6. フォールトトレランス
- ブローカーダウン/タイムアウト時は **リトライはしない**（Outboxに委譲）
- DB 障害時は **readiness probe で切り離し**、再送で整合回復

---

## 7. 変更管理
- 互換性: API は **拡張のみ**（意味変更・削除は非推奨）
- バージョニング: `v1.x` 維持、破壊的変更は `v2` として並行提供

---

## 8. 変更履歴
- **2025-08-24**: 初版
