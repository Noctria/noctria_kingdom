flowchart LR
  %% メインGUI部分を1つのサブグラフとして整理
  subgraph GUI_Main["noctria_gui/main.py"]
    direction TB
    HOME["home_routes (noctria_gui/routes/home.py) -> home.html"]
    DASHBOARD["dashboard (noctria_gui/routes/dashboard.py) -> dashboard.html"]
    AI_ROUTES["ai_routes (noctria_gui/routes/ai_routes.py) -> ai_list.html / ai_detail.html"]
    KING["king_routes (noctria_gui/routes/king_routes.py) -> king_history.html"]
    TRIGGER["trigger (noctria_gui/routes/trigger.py) -> trigger.html
      - Airflow DAG一覧取得 (list_dags)
      - ユーザーがDAGを選択して発令
      - src/core/dag_trigger.py経由でAirflow DAGトリガー連携"]
    UPLOAD["upload (noctria_gui/routes/upload.py) -> upload_strategy.html"]
    UPLOAD_HISTORY["upload_history (noctria_gui/routes/upload_history.py) -> upload_history.html"]
    ACT_HISTORY["act_history (noctria_gui/routes/act_history.py) -> act_history.html"]
    ACT_HISTORY_DETAIL["act_history_detail (noctria_gui/routes/act_history_detail.py) -> act_history_detail.html"]
    LOGS["logs_routes (noctria_gui/routes/logs_routes.py) -> logs_dashboard.html"]
    PDCA["pdca (noctria_gui/routes/pdca.py) -> pdca_dashboard.html"]
    PDCA_RECHECK["pdca_recheck (noctria_gui/routes/pdca_recheck.py) -> pdca_history.html"]
    PDCA_ROUTES["pdca_routes (noctria_gui/routes/pdca_routes.py)"]
    PDCA_SUMMARY["pdca_summary (noctria_gui/routes/pdca_summary.py)"]
    PUSH["push (noctria_gui/routes/push.py)"]
    PUSH_HISTORY["push_history (noctria_gui/routes/push_history.py) -> push_history.html"]
    HERMES["hermes (noctria_gui/routes/hermes.py) -> hermes.html"]
    STRATEGY_ROUTES["strategy_routes (noctria_gui/routes/strategy_routes.py) -> strategy_compare.html"]
    STRATEGY_DETAIL["strategy_detail (noctria_gui/routes/strategy_detail.py) -> strategy_detail.html"]
    STRATEGY_HEATMAP["strategy_heatmap (noctria_gui/routes/strategy_heatmap.py) -> strategy_heatmap.html"]
    STAT_DETAIL["statistics_detail (noctria_gui/routes/statistics_detail.py) -> statistics_detail.html"]
    STAT_RANKING["statistics_ranking (noctria_gui/routes/statistics_ranking.py) -> statistics_ranking.html"]
    STAT_SCOREBOARD["statistics_scoreboard (noctria_gui/routes/statistics_scoreboard.py) -> statistics_scoreboard.html"]
    STAT_TAG_RANKING["statistics_tag_ranking (noctria_gui/routes/statistics_tag_ranking.py) -> statistics_tag_ranking.html"]
    STAT_COMPARE["statistics_compare (noctria_gui/routes/statistics_compare.py) -> statistics_compare.html"]
    TAG_SUMMARY["tag_summary (noctria_gui/routes/tag_summary.py) -> tag_summary.html"]
    TAG_SUMMARY_DETAIL["tag_summary_detail (noctria_gui/routes/tag_summary_detail.py) -> tag_summary_detail.html"]
    TAG_HEATMAP["tag_heatmap (noctria_gui/routes/tag_heatmap.py) -> tag_heatmap.html"]
    PATH_CHECKER["path_checker (noctria_gui/routes/path_checker.py)"]
    PROMETHEUS_ROUTES["prometheus_routes (noctria_gui/routes/prometheus_routes.py)"]
  end

  %% サービス部分を別サブグラフに分ける
  subgraph Services["noctria_gui/services"]
    direction TB
    ACT_LOG_SERVICE["act_log_service (noctria_gui/services/act_log_service.py)"]
    DASHBOARD_SERVICE["dashboard_service (noctria_gui/services/dashboard_service.py)"]
    PUSH_HISTORY_SERVICE["push_history_service (noctria_gui/services/push_history_service.py)"]
    STATISTICS_SERVICE["statistics_service (noctria_gui/services/statistics_service.py)"]
    STRATEGY_HANDLER["strategy_handler (noctria_gui/services/strategy_handler.py)"]
    TAG_SUMMARY_SERVICE["tag_summary_service (noctria_gui/services/tag_summary_service.py)"]
    UPLOAD_ACTIONS["upload_actions (noctria_gui/services/upload_actions.py)"]
  end

  %% GUI Mainから各Routesへのinclude
  GUI_Main -->|include_router| HOME
  GUI_Main --> DASHBOARD
  GUI_Main --> AI_ROUTES
  GUI_Main --> KING
  GUI_Main --> TRIGGER
  GUI_Main --> UPLOAD
  GUI_Main --> UPLOAD_HISTORY
  GUI_Main --> ACT_HISTORY
  GUI_Main --> ACT_HISTORY_DETAIL
  GUI_Main --> LOGS
  GUI_Main --> PDCA
  GUI_Main --> PDCA_RECHECK
  GUI_Main --> PDCA_ROUTES
  GUI_Main --> PDCA_SUMMARY
  GUI_Main --> PUSH
  GUI_Main --> PUSH_HISTORY
  GUI_Main --> HERMES
  GUI_Main --> STRATEGY_ROUTES
  GUI_Main --> STRATEGY_DETAIL
  GUI_Main --> STRATEGY_HEATMAP
  GUI_Main --> STAT_DETAIL
  GUI_Main --> STAT_RANKING
  GUI_Main --> STAT_SCOREBOARD
  GUI_Main --> STAT_TAG_RANKING
  GUI_Main --> STAT_COMPARE
  GUI_Main --> TAG_SUMMARY
  GUI_Main --> TAG_SUMMARY_DETAIL
  GUI_Main --> TAG_HEATMAP
  GUI_Main --> PATH_CHECKER
  GUI_Main --> PROMETHEUS_ROUTES

  %% ダッシュボードからアクセスリンク（追加）
  DASHBOARD --> STRATEGY_ROUTES
  DASHBOARD --> PDCA_SUMMARY
  DASHBOARD --> AI_ROUTES
  DASHBOARD --> TRIGGER
  DASHBOARD --> ACT_HISTORY
  DASHBOARD --> PUSH
  DASHBOARD --> PUSH_HISTORY
  DASHBOARD --> HERMES

  %% Routes が Service を利用
  ACT_HISTORY --> ACT_LOG_SERVICE
  ACT_HISTORY_DETAIL --> ACT_LOG_SERVICE
  PDCA --> ACT_LOG_SERVICE
  PDCA_RECHECK --> ACT_LOG_SERVICE
  PDCA_ROUTES --> ACT_LOG_SERVICE
  PDCA_SUMMARY --> ACT_LOG_SERVICE

  DASHBOARD --> DASHBOARD_SERVICE
  AI_ROUTES --> DASHBOARD_SERVICE
  PUSH --> PUSH_HISTORY_SERVICE
  PUSH_HISTORY --> PUSH_HISTORY_SERVICE
  STAT_DETAIL --> STATISTICS_SERVICE
  STAT_RANKING --> STATISTICS_SERVICE
  STAT_SCOREBOARD --> STATISTICS_SERVICE
  STAT_TAG_RANKING --> STATISTICS_SERVICE
  STAT_COMPARE --> STATISTICS_SERVICE
  TAG_SUMMARY --> TAG_SUMMARY_SERVICE
  TAG_SUMMARY_DETAIL --> TAG_SUMMARY_SERVICE
  TAG_HEATMAP --> TAG_SUMMARY_SERVICE
  UPLOAD --> STRATEGY_HANDLER
  UPLOAD_HISTORY --> UPLOAD_ACTIONS
  STRATEGY_ROUTES --> STRATEGY_DETAIL
  STRATEGY_ROUTES --> STRATEGY_HEATMAP

  PROMETHEUS_ROUTES --> PROMETHEUS_ROUTES

  %% GUIのDAGトリガー連携（src/core/dag_trigger.py経由）
  TRIGGER -.-> src_core_dag_trigger["src/core/dag_trigger.py\nAirflow DAG一覧取得・DAGトリガー連携"]
  src_core_dag_trigger --> PDCA
