flowchart TD
  %% ===== PLAN å±¤ =====
  subgraph PLAN["ğŸ—ºï¸ PLAN å±¤ (src/plan_data)"]
    COLLECT[collector.py<br/>å¸‚å ´/ãƒã‚¯ãƒ­/ãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†]
    FEATURES[features.py<br/>ç‰¹å¾´é‡ç”Ÿæˆ]
    STATS[statistics.py<br/>KPIé›†è¨ˆ]
    ANALYZER[analyzer.py<br/>è¦å› æŠ½å‡º/èª¬æ˜]
  end

  %% ===== STRATEGY AI å±¤ =====
  subgraph STRATS["ğŸ¤– æˆ¦ç•¥AI (src/strategies)"]
    AURUS[AurusSingularis]
    LEVIA[LeviaTempest]
    PROME[PrometheusOracle]
    VERITAS[VeritasMachina]
  end

  %% ===== DO å±¤ =====
  subgraph DO["âš™ï¸ DO å±¤ (å®Ÿè¡Œ/æ³¨æ–‡/ç›£è¦–)"]
    EXEC[execution/order_router.py]
    RISK[core/risk_control.py]
    MONI[execution/challenge_monitor.py]
  end

  %% ===== CHECK å±¤ =====
  subgraph CHECK["ğŸ” CHECK å±¤ (æ¤œè¨¼/è©•ä¾¡)"]
    EVAL[veritas_evaluator.py]
    METRICS[metrics_aggregator.py]
  end

  %% ===== ACT å±¤ =====
  subgraph ACT["âœ… ACT å±¤ (æ¡ç”¨/Push)"]
    ADOPT[act_adopt.py]
    GIT[src/core/git_utils.py]
    REG[src/core/decision_registry.py]
  end

  %% ===== KING =====
  subgraph KING["ğŸ‘‘ KING çµ±æ²» (src/king_noctria.py)"]
    DECIDE[æœ€çµ‚æ„æ€æ±ºå®š / PDCAçµ±æ²»]
  end

  %% ===== GUI =====
  subgraph GUI["ğŸ–¥ï¸ GUI HUD (noctria_gui)"]
    ROUTES[routes/*]
    TEMPL[templates/*]
  end

  %% ===== ORCHESTRATOR =====
  subgraph ORCH["ğŸ•¸ï¸ Orchestrator (Airflow DAGs)"]
    DAGS[airflow_docker/dags/*]
  end

  %% ===== OBSERVABILITY =====
  subgraph OBS["ğŸ“¡ Observability (Postgres/Logs)"]
    DB[(Postgres: obs_plan_runs<br/>obs_infer_calls<br/>idempo_ledger)]
    LOGS[(logs/*)]
  end

  %% ===== Connections =====
  PLAN --> STRATS
  STRATS --> DO
  DO --> CHECK
  CHECK --> ACT
  ACT --> KING
  KING --> DO
  KING --> ORCH
  ORCH --> STRATS
  ORCH --> CHECK
  ORCH --> ACT
  GUI --> KING
  GUI --> ORCH
  PLAN --> OBS
  STRATS --> OBS
  DO --> OBS
  CHECK --> OBS
  ACT --> OBS
  KING --> OBS
