flowchart TD
  %% --- Plan層 ---
  subgraph PLAN["🗺️ PLAN層（collector→features→analyzer/statistics）"]
    COLLECT["PlanDataCollector<br>市場データ収集"]
    FEATENG["FeatureEngineer<br>特徴量生成"]
    FEATDF["特徴量DataFrame/Dict出力"]
    ANALYZER["PlanAnalyzer<br>要因抽出/ラベル"]
  end

  %% --- AI臣下たち ---
  subgraph AI_UNDERLINGS["🤖 臣下AI群（src/strategies/）"]
    AURUS["🎯 Aurus<br>総合分析<br><b>propose()</b>"]
    LEVIA["⚡ Levia<br>スキャルピング<br><b>propose()</b>"]
    NOCTUS["🛡️ Noctus<br>リスク/ロット判定<br><b>calculate_lot_and_risk()</b>"]
    PROMETHEUS["🔮 Prometheus<br>未来予測<br><b>predict_future()</b>"]
    HERMES["🦉 Hermes<br>LLM説明<br><b>propose()</b>"]
    VERITAS["🧠 Veritas<br>戦略提案<br><b>propose()</b>"]
  end

  %% --- D層（受け渡し先のみ） ---
  subgraph DO_LAYER["⚔️ Do層（受け渡し先）"]
    ORDER["order_execution.py<br>発注API本体"]
  end

  %% --- 連携 ---
  COLLECT --> FEATENG
  FEATENG --> FEATDF
  FEATDF -->|最新dict/DF/feature_order| AURUS
  FEATDF --> LEVIA
  FEATDF --> NOCTUS
  FEATDF --> PROMETHEUS
  FEATDF --> VERITAS

  FEATDF --> ANALYZER
  ANALYZER --> HERMES

  %% --- D層への受け渡し ---
  AURUS --> ORDER
  LEVIA --> ORDER
  NOCTUS --> ORDER
  PROMETHEUS --> ORDER
  VERITAS --> ORDER

  %% --- サンプルデモ ---
  subgraph DEMO["plan_to_all_minidemo.py"]
    DEMOENTRY["全AI同時呼び出し"]
  end
  DEMOENTRY --> FEATDF
  DEMOENTRY -.-> AURUS
  DEMOENTRY -.-> LEVIA
  DEMOENTRY -.-> NOCTUS
  DEMOENTRY -.-> PROMETHEUS
  DEMOENTRY -.-> HERMES
  DEMOENTRY -.-> VERITAS

  %% --- 装飾 ---
  classDef plan fill:#262e44,stroke:#47617a,color:#d8e0f7
  classDef ai fill:#333,color:#ffe476,stroke:#a97e2c
  classDef demo fill:#25252a,stroke:#f6e58d,color:#fffaad
  classDef do fill:#3d2d2d,stroke:#cc9999,color:#ffcccc

  class PLAN plan
  class AI_UNDERLINGS ai
  class DEMO demo
  class DO_LAYER do

  %% --- 補足 ---
  click DEMOENTRY "https://github.com/your_repo/src/plan_data/plan_to_all_minidemo.py" "サンプル実装ファイル"
