# PDCA GUI â€” ç”»é¢ä»•æ§˜ï¼ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ  & ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ï¼‰
**Last Updated:** 2025-08-24 (JST)  
**Owner:** PDCA / Platform / UX

é–¢é€£æ–‡æ›¸:
- `docs/apis/PDCA-GUI-API-Spec.md`
- `docs/apis/PDCA-Recheck-API-Spec.md`
- `docs/airflow/DAG-PDCA-Recheck.md`
- `docs/architecture/schema/PDCA-MetaSchema.md`

---

## 0. ãƒ‡ã‚¶ã‚¤ãƒ³åŸå‰‡
- **é‹ç”¨å„ªå…ˆ**ï¼šçŠ¶æ…‹ã®ä¸€ç›®æŠŠæ¡ï¼ˆå¥å…¨/åŠ£åŒ–/ä¸æ˜ï¼‰ã¨â€å†ãƒã‚§ãƒƒã‚¯â€ã®å³æ™‚æ“ä½œ
- **éåŒæœŸå¿—å‘**ï¼šAPIã¯202è¿”å´ã€é€²æ—ã¯ãƒãƒ¼ãƒªãƒ³ã‚°/ãƒ—ãƒƒã‚·ãƒ¥ã§è¿½è·¡
- **å®‰å…¨ç¬¬ä¸€**ï¼šIdempotencyã€RateLimitã€æ¨©é™è¡¨ç¤ºã€ç ´å£Šæ“ä½œã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**ï¼šã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯ã€ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ AAã€ARIA ãƒ­ãƒ¼ãƒ«
- **å›½éš›åŒ–**ï¼ši18n ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼ˆ`t('â€¦')`ï¼‰ã§æ–‡è¨€æŠ½è±¡åŒ–

---

## 1. ç”»é¢ä¸€è¦§
1. **S-01 æˆ¦ç•¥ä¸€è¦§**ï¼ˆDashboard/Listï¼‰
2. **S-02 æˆ¦ç•¥è©³ç´°**ï¼ˆDetailï¼‰
3. **S-03 å†ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œãƒ€ã‚¤ã‚¢ãƒ­ã‚°**ï¼ˆSingle/Bulkï¼‰
4. **S-04 ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€²æ—**ï¼ˆRequest Progressï¼‰
5. **S-05 æˆæœç‰©ãƒ“ãƒ¥ãƒ¼ã‚¢/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ï¼ˆArtifact Viewerï¼‰

---

## S-01 æˆ¦ç•¥ä¸€è¦§ï¼ˆDashboard/Listï¼‰
### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
```
+----------------------------------------------------------------------------------+
| PDCA Dashboard                           [User: ops-ui]     [Create Recheck]     |
+----------------------------------------------------------------------------------+
| Search [ q: strat / title ]  Health [All|Healthy|Degraded|Unknown]  Tags [..]   |
| Instrument [USDJPY, EURUSD...]   Enabled [All|On|Off]   Sort [Last Check â–¼]     |
|                                                                            [âŸ³] |
+----------------------------------------------------------------------------------+
| ID                    | Instrument | Health   | Last Checked        | Tags   | â‹¯ |
| strat.meanrev.m1      | USDJPY     | â—Healthy | 2025-08-24 11:31    | daily  | ğŸ”|
| strat.breakout.h1     | USDJPY     | â–²Degrad. | 2025-08-24 10:50    | alert  | ğŸ”|
| strat.arb.l3          | EURUSD     | ?Unknown | â€”                   | exp    | ğŸ”|
+----------------------------------------------------------------------------------+
| Page 1 / 3    â—€ Prev   1  2  3  Next â–¶                                          |
+----------------------------------------------------------------------------------+
Legend: â— Healthy  â–² Degraded  ? Unknown
```

### ãƒ‡ãƒ¼ã‚¿ãƒ»API
- GET `/gui/strategies?q=&tags_any=&health=&instrument=&enabled=&sort=&page=&page_size=`
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹: `items[].{id,title,instrument,enabled,last_health,last_checked_at,tags[]}`

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
| UIé …ç›® | å‹/åˆ¶ç´„ | å‚™è€ƒ |
|---|---|---|
| q | string(0..64) | ID/title ã®éƒ¨åˆ†ä¸€è‡´ |
| health | enum[] | `healthy,degraded,unknown` |
| tags_any | string[] | OR æ¡ä»¶ |
| instrument | string[] | OR æ¡ä»¶ |
| enabled | enum | `all,on,off` |
| sort | enum | `last_checked_at.desc`(æ—¢å®š), `id.asc` ãªã© |
| page,page_size | int | 1.. / 10..100 |

### æŒ¯ã‚‹èˆã„
- è¡Œæœ«ã€ŒğŸ”ã€ã§ **S-02** ã¸é·ç§»
- ã€ŒCreate Recheckã€ã§ **S-03** ã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼ˆå˜ä½“/ä¸€æ‹¬åˆ‡æ›¿ï¼‰
- ã‚ªãƒ¼ãƒˆãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ [âŸ³]ï¼š60s é–“éš”ï¼ˆãƒˆã‚°ãƒ«ã§åœæ­¢å¯ï¼‰

### çŠ¶æ…‹/ã‚¨ãƒ©ãƒ¼
- ç©ºçŠ¶æ…‹ï¼šâ€ä¸€è‡´ã™ã‚‹æˆ¦ç•¥ãŒã‚ã‚Šã¾ã›ã‚“â€
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚±ãƒ«ãƒˆãƒ³ï¼ˆ3ã€œ10 è¡Œï¼‰
- ã‚¨ãƒ©ãƒ¼ï¼šãƒãƒŠãƒ¼ï¼ˆ`t('load_failed')` å†è©¦è¡Œãƒœã‚¿ãƒ³ï¼‰

---

## S-02 æˆ¦ç•¥è©³ç´°ï¼ˆDetailï¼‰
### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
```
+----------------------------------------------------------------------------------+
| Strategy: strat.meanrev.m1        [Healthy â—]  [Recheck]  [Open Artifacts]      |
| Title: Mean Reversion M1                     Instrument: USDJPY  Enabled: On     |
+----------------------------------------------------------------------------------+
| KPI (30d):  Sharpe 1.10  | Winrate 0.56 | MaxDD 0.08   Last: 2025-08-24 11:31    |
| Chart(30d):  â”€â”€â”€â”€â–â–‚â–ƒâ–…â–ˆâ–‡â–†â–…â–ƒâ–‚â”€ â€¦                                                 |
+----------------------------------------------------------------------------------+
| Recent Results (limit=20)                                                         |
| Completed At           | Health   | Sharpe | Winrate | MaxDD | RequestId  | â‹¯    |
| 2025-08-24 11:31       | Healthy  | 1.25   | 0.57    | 0.07  | 01JABCâ€¦    | ğŸ”—    |
| 2025-08-23 10:03       | Degraded | 0.70   | 0.49    | 0.12  | 01JDEFâ€¦    | ğŸ”—    |
+----------------------------------------------------------------------------------+
```

### ãƒ‡ãƒ¼ã‚¿ãƒ»API
- GET `/gui/strategies/:id?summary_window_days=30&limit_history=20`
- GET `/gui/strategies/:id/results?from=&to=&limit=`
- KPIã‚°ãƒ©ãƒ•ã¯ results ã®æ™‚ç³»åˆ—ã‹ã‚‰æç”»

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ã‚­ãƒ¼ | å‹/åˆ¶ç´„ | å‚™è€ƒ |
|---|---|---|---|
| ã‚µãƒãƒª | kpi_avg | `{sharpe,winrate,max_dd}` | NaN/æ¬ æã¯ `null` |
| å±¥æ­´ | items[] | `completed_at,health,metrics{â€¦},result_digest,request_id` | ã‚¯ãƒªãƒƒã‚¯ã§ **S-04** |

### æ“ä½œ
- [Recheck] â†’ **S-03**ï¼ˆå˜ä½“ãƒ¢ãƒ¼ãƒ‰ã§ `strategies=[id]` å›ºå®šï¼‰
- [Open Artifacts] â†’ **S-05**ï¼ˆè©²å½“æˆ¦ç•¥ã®ç›´è¿‘ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ä¸€è¦§ï¼‰

---

## S-03 å†ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆSingle/Bulkï¼‰
### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
```
+-------------------------------- Recheck ----------------------------------------+
| Mode: (â— Single / â—‹ Bulk)                                                       |
| Strategies: [ strat.meanrev.m1 ] [+Add]                                         |
| Window:  ( ) From [2025-08-10T00:00Z] To [2025-08-24T00:00Z]                    |
|          (â—) Lookback [ 14 ] days                                               |
| Reason:  [ manual | daily-healthcheck | anomaly-detected | custom: ______ ]     |
| Params:  [x] recalc_metrics: (winrate)(sharpe)(max_dd)   [ ] retrain            |
| Dry Run: [x]                                                                     |
|                                                                 [Cancel] [Run]  |
+----------------------------------------------------------------------------------+
```

### å…¥å‡ºåŠ›ãƒ»API
- å˜ä½“: `POST /pdca/recheck`ï¼ˆ202 ã§ `request_id`, `estimated`ï¼‰
- ä¸€æ‹¬: `POST /pdca/recheck_all`
- Idempotency-Key: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ ULID ç”Ÿæˆï¼ˆå†é€ã§åŒä¸€ã‚­ãƒ¼ï¼‰

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹/åˆ¶ç´„ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
|---|---|---|
| strategies[] | 1..50 | `/^[a-z0-9._-]+$/` |
| window.from/to or lookback_days | ç›¸äº’æ’ä»– | æœ€å¤§180æ—¥ |
| reason | enum or string(1..64) | æ—¢å®šå€™è£œ + ä»»æ„ |
| params.recalc_metrics[] | enum | `winrate,sharpe,max_dd` |
| params.retrain | bool | æ—¢å®š=false |
| dry_run | bool | æ—¢å®š=true |

### UI ãƒ«ãƒ¼ãƒ«
- Dry Run æ™‚ï¼š**Run** ã¯ã€ŒEstimateã€ã¨è¡¨ç¤ºã€çµæœä»¶æ•°ï¼ˆ`estimated.strategies/batches`ï¼‰ã‚’ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
- å®Ÿè¡Œæ™‚ï¼šå®Œäº†å¾Œ **S-04** ã«é·ç§»ï¼ˆ`request_id` ã‚’æ¸¡ã™ï¼‰

---

## S-04 ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€²æ—ï¼ˆRequest Progressï¼‰
### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
```
+------------------------------ Recheck Progress ---------------------------------+
| Request: 01JABCXYZ-ULID-5678      Status: Running â–·    [Refresh âŸ³] [Back]       |
+----------------------------------------------------------------------------------+
| Batches: [â– â– â–¡â–¡â–¡â–¡]  1/5   Strategies: 12/60  Elapsed: 03:11                      |
| Failures: 2   Healthy: 9   Degraded: 3   Unknown: 0                              |
+----------------------------------------------------------------------------------+
| Recent Activity                                                                  |
| 11:31  strat.meanrev.m1   âœ” success  sharpe 1.25  report: â€¦/artifacts/123        |
| 11:28  strat.breakout.h1  âœ– failed   reason=DATA_SOURCE_DOWN                     |
+----------------------------------------------------------------------------------+
| Report: [Download HTML] [Open Dashboard]                                         |
+----------------------------------------------------------------------------------+
```

### ãƒ‡ãƒ¼ã‚¿ãƒ»API
- GET `/gui/requests/:request_id`
- ãƒãƒ¼ãƒªãƒ³ã‚°ï¼š5sï¼ˆæ‰‹å‹•æ›´æ–°ãƒœã‚¿ãƒ³ [âŸ³] ã‚‚æä¾›ï¼‰

### è¡¨ç¤ºé …ç›®
- `status`ï¼ˆ`running|success|failed`ï¼‰
- é€²æ—: `total_batches/completed_batches`, `total_strategies/completed_strategies`
- ã‚µãƒãƒª: æˆåŠŸ/å¤±æ•—/å¥åº·åˆ†å¸ƒ
- æœ€æ–°ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ï¼ˆãƒ­ã‚°é¢¨ï¼‰â€” ç›´è¿‘ 20 ä»¶

---

## S-05 æˆæœç‰©ãƒ“ãƒ¥ãƒ¼ã‚¢/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆArtifact Viewerï¼‰
### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
```
+------------------------------ Artifacts ----------------------------------------+
| Strategy: strat.meanrev.m1           [Back]                                     |
+----------------------------------------------------------------------------------+
| Filter: Kind [All|chart|report|csv]   Range: [ from ][ to ]   [Search q] [âŸ³]    |
+----------------------------------------------------------------------------------+
| ID   | Kind   | Created At           | Size   | Action                           |
| 123  | chart  | 2025-08-24 11:31     | 120KB  | [Preview] [Download]             |
| 777  | report | 2025-08-24 03:54     | 890KB  | [Open] [Download]                |
+----------------------------------------------------------------------------------+
```

### ãƒ‡ãƒ¼ã‚¿ãƒ»API
- GET `/gui/strategies/:id`ï¼ˆartifacts æ¦‚è¦ï¼‰
- GET `/gui/artifacts/:artifact_id/url` â†’ çŸ­å‘½ã®ç½²åä»˜ã URL
- ç”»åƒç³»ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒ¬ãƒãƒ¼ãƒˆã¯æ–°è¦ã‚¿ãƒ–

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
| é …ç›® | å‹ | å‚™è€ƒ |
|---|---|---|
| kind | enum | `chart,report,csv,other` |
| url | string | æœŸé™ä»˜ãã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã¿ç”Ÿæˆ |
| bytes_size | number | ãƒ’ãƒˆå¯èª­è¡¨ç¤ºï¼ˆKB/MBï¼‰ |

---

## 2. å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»•æ§˜
### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
- Healthy: ç·‘ â—, aria-label=`t('healthy')`
- Degraded: é»„ â–², aria-label=`t('degraded')`
- Unknown: ç° ?, aria-label=`t('unknown')`

### æ—¥ä»˜/æ™‚åˆ»è¡¨ç¤º
- æ—¢å®š: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼ˆJSTï¼‰ + ISO è¡¨ç¤º
- ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã« UTC ã‚’ä½µè¨˜

### ãƒ†ãƒ¼ãƒ–ãƒ«
- åˆ—ä¸¦ã¹æ›¿ãˆï¼š`Last Checked`/`ID`/`Instrument`/`Health`
- ãƒšãƒ¼ã‚¸ãƒ³ã‚°ï¼šãƒšãƒ¼ã‚¸ç•ªå· + ç·ä»¶æ•°
- ç©º/ã‚¨ãƒ©ãƒ¼/ãƒ­ãƒ¼ãƒ‰æ™‚ã®3çŠ¶æ…‹ã‚’çµ±ä¸€ã‚¹ã‚¿ã‚¤ãƒ«ã§æä¾›

---

## 3. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–é †ã®è¨­è¨ˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒˆãƒ©ãƒƒãƒ—
- é‡è¦ãƒœã‚¿ãƒ³ï¼ˆRun/Downloadï¼‰ã¯ `aria-disabled` ã¨ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆä¾‹: Alt+Rï¼‰
- ã‚°ãƒ©ãƒ•ã«ã¯**æ•°å€¤ãƒ†ãƒ¼ãƒ–ãƒ«ä»£æ›¿**ã‚’å¿…ãšè¡¨ç¤º

---

## 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/æ¨©é™è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ã® `scopes` ã‚’ãƒ˜ãƒƒãƒ€ã«è¡¨ç¤ºï¼ˆä¾‹: `pdca:read, pdca:recheck`ï¼‰
- æ¨©é™ä¸è¶³æ™‚ã¯**éè¡¨ç¤º**ã‚‚ã—ãã¯**disabled**ï¼‹ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ï¼ˆâ€æ¨©é™ãŒå¿…è¦ã§ã™â€ï¼‰
- ç½²åä»˜ãURLã¯**éƒ½åº¦ç™ºè¡Œ**ï¼ˆã‚³ãƒ”ãƒ¼ã‚¬ãƒ¼ãƒ‰ã®æ³¨æ„æ–‡ã‚’è¡¨ç¤ºï¼‰

---

## 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆHTTP â†’ UIï¼‰
| HTTP | è¡¨ç¤º | å†è©¦è¡Œ |
|---|---|---|
| 400/422 | å…¥åŠ›ã‚¨ãƒ©ãƒ¼è¡Œã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¡¨ç¤º | ä¿®æ­£å¾Œé€ä¿¡ |
| 401/403 | ãƒˆãƒ¼ã‚¹ãƒˆ + ãƒ­ã‚°ã‚¤ãƒ³å°ç·š | å†ãƒ­ã‚°ã‚¤ãƒ³ |
| 409 | ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆIdempotency å·®åˆ†ï¼‰ | é€ä¿¡å†…å®¹ã‚’ç¢ºèª |
| 429 | ãƒˆãƒ¼ã‚¹ãƒˆï¼ˆRetry-After ç§’ï¼‰ | è‡ªå‹•å†è©¦è¡ŒæŠ‘åˆ¶ |
| 5xx/502 | ãƒãƒŠãƒ¼ï¼ˆAirflow/Serverï¼‰ | ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ |

---

## 6. ã‚¤ãƒ™ãƒ³ãƒˆè¿½è·¡/ãƒ†ãƒ¬ãƒ¡ãƒˆãƒª
- `ui.action`ï¼š`recheck.run`, `recheck.dryrun`, `artifact.download`, `list.filter`
- `ui.latency_ms`ï¼šAPIå¾€å¾©æ™‚é–“ï¼ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ¥ï¼‰
- `ui.error_total{code}`ï¼šHTTP ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥

---

## 7. è¨­å®šï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ .envï¼‰
| KEY | æ—¢å®š | èª¬æ˜ |
|---|---|---|
| `VITE_API_BASE` | `http://localhost:8001` | API ãƒ™ãƒ¼ã‚¹URL |
| `VITE_POLL_INTERVAL_MS` | `5000` | é€²æ—ãƒãƒ¼ãƒªãƒ³ã‚° |
| `VITE_PAGE_SIZE_DEFAULT` | `50` | ä¸€è¦§ã®ä»¶æ•° |
| `VITE_SIGNED_URL_TTL` | `300` | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ URL ã®å¯¿å‘½ï¼ˆç§’ï¼‰ |

---

## 8. i18n ã‚­ãƒ¼ä¾‹
```
dashboard.title = "PDCA Dashboard"
status.healthy = "Healthy"
status.degraded = "Degraded"
status.unknown = "Unknown"
action.recheck = "Recheck"
action.refresh = "Refresh"
msg.no_data = "No items found"
msg.load_failed = "Failed to load"
```

---

## 9. å¤‰æ›´å±¥æ­´
- **2025-08-24**: åˆç‰ˆï¼ˆä¸€è¦§/è©³ç´°/å†ãƒã‚§ãƒƒã‚¯/é€²æ—/æˆæœç‰©ã€å…±é€šUIã€A11yã€i18nï¼‰
