flowchart TD

%% ======================== Kingdom/AI中枢クラスタ =========================
subgraph Kingdom_Council["👑 Noctria Kingdom 統治・PDCA系DAG"]
    K_PDCA["noctria_kingdom_pdca_dag.py<br>🏰 PDCA最適化＆王の最終判断"]
    K_RC["noctria_kingdom_dag.py<br>👑 御前会議・最終決断"]
    K_SIM["simulate_strategy_dag.py<br>📊 昇格戦略シミュレーション"]
    K_META_APPLY["metaai_apply_dag.py<br>📌 MetaAI最適パラ適用"]
    K_META_EVAL["metaai_evaluate_dag.py<br>📊 MetaAIモデル評価"]
end

%% ====================== 四臣下DAGクラスター =========================
subgraph Ministers["四臣下DAG（AIエージェント戦略系）"]
    AURUS["aurus_strategy_dag.py<br>⚔️ Aurus Trend解析"]
    LEVIA["levia_strategy_dag.py<br>⚡ Levia スキャルピング"]
    NOCTUS["noctus_strategy_dag.py<br>🛡️ Noctus リスク評価"]
    PROMETHEUS["prometheus_strategy_dag.py<br>🔮 Prometheus 未来予測"]
    HERMES["hermes_strategy_dag.py<br>🦉 Hermes Cognitor LLM要約"]
end

%% ====================== Veritas PDCA/Replay/生成 =========================
subgraph Veritas_Master["Veritas PDCA/Replay/生成系"]
    V_PDCA["veritas_pdca_dag.py<br>🔁 PDCAサイクル自動化"]
    V_GEN["veritas_generate_dag.py<br>🧠 戦略自動生成＋GitHub Push"]
    V_EVAL["veritas_eval_dag.py<br>✅ 戦略一括評価"]
    V_EVAL1["veritas_eval_single_dag.py<br>🔁 単体再評価"]
    V_PUSH["veritas_push_dag.py<br>⬆️ 採用戦略Push"]
    V_RECHECK["veritas_recheck_dag.py<br>🔎 個別戦略再評価"]
    V_REPLAY["veritas_replay_dag.py<br>🔄 PDCAログから再送"]
    V_ACTREC["veritas_act_record_dag.py<br>🗒️ Act記録（統治ID必須）"]
    V_TO_ORDER["veritas_to_order_dag.py<br>⚔️ EA命令書自動生成"]
    V_REFACTOR["veritas_refactor_dag.py<br>🔧 Veritas構造リファクタ"]
end

%% ====================== PDCA/分析・自動要因サマリー系 ======================
subgraph PDCA_Analysis["PDCA/Plan/分析系"]
    PDCA_SUMMARY["pdca_plan_summary_dag.py<br>📋 要因分析＆自動サマリー"]
    STRUCT_CHECK["structure_check_dag.py<br>🧱 パス・構造Lint"]
    VERIFY_PATH["verify_path_config_dag.py<br>🛡️ パス検査"]
end

%% ========= メイン依存・連携矢印（PDCA連携・自動化フロー） =========

%% PDCA中枢
K_PDCA --四臣連携/昇格フロー--> K_RC
K_PDCA --PDCA最適化連携--> K_META_APPLY
K_META_APPLY --評価連携--> K_META_EVAL

%% Aurus/Levia/Noctus/Prometheus/Hermesは独立DAG
AURUS ---|戦略データ| K_PDCA
LEVIA ---|戦略データ| K_PDCA
NOCTUS ---|リスク評価| K_PDCA
PROMETHEUS ---|予測データ| K_PDCA
HERMES ---|要約・説明| K_PDCA

%% Veritas PDCA統合
V_PDCA --> V_GEN --> V_EVAL --> V_PUSH
V_EVAL1 -. 個別再評価 .-> V_EVAL
V_RECHECK -. 個別再評価 .-> V_EVAL
V_GEN --> V_TO_ORDER
V_TO_ORDER --> V_ACTREC

%% リファクタ・検証
V_REFACTOR --> STRUCT_CHECK
STRUCT_CHECK --> VERIFY_PATH

%% 分析・サマリー
PDCA_SUMMARY --> K_PDCA

%% その他：Replay・再送
V_REPLAY -. 再送/再現 .-> V_PDCA

