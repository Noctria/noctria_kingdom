flowchart TD
  %% === AI/統治コア ===
  KingNoctria[src/core/king_noctria.py<br>👑 KingNoctria]
  VeritasMachina[src/veritas/veritas_machina.py<br>🧠 VeritasMachina]
  PrometheusOracle[src/strategies/prometheus_oracle.py<br>🔮 PrometheusOracle]
  AurusSingularis[src/strategies/aurus_singularis.py<br>⚔️ AurusSingularis]
  LeviaTempest[src/strategies/levia_tempest.py<br>⚡ LeviaTempest]
  NoctusSentinella[src/strategies/noctus_sentinella.py<br>🛡️ NoctusSentinella]
  HermesCognitor[src/strategies/hermes_cognitor.py<br>🦉 HermesCognitor]
  PlanStatistics[src/plan_data/statistics.py<br>PlanStatistics]
  AnomalyDetector[src/plan_data/anomaly_detector.py<br>AnomalyDetector]
  PlanCollector[src/plan_data/collector.py<br>PlanDataCollector]
  FeatureEngineer[src/plan_data/features.py<br>FeatureEngineer]
  DataLoader[src/core/data_loader.py<br>MarketDataFetcher]
  Logger[src/core/logger.py<br>Logger]

  %% === 統治API/ルート ===
  KingRoutes[noctria_gui/routes/king_routes.py<br>API: /api/king]
  Dashboard[noctria_gui/routes/dashboard.py<br>Dashboard]
  PDCARecheck[noctria_gui/routes/pdca_recheck.py]
  PDCA[noctria_gui/routes/pdca.py]
  
  %% === Airflow DAG ===
  NoctriaKingdomDAG[airflow_docker/dags/noctria_kingdom_dag.py]
  AurusDAG[airflow_docker/dags/aurus_strategy_dag.py]
  LeviaDAG[airflow_docker/dags/levia_strategy_dag.py]
  PrometheusDAG[airflow_docker/dags/prometheus_strategy_dag.py]
  NoctusDAG[airflow_docker/dags/noctus_strategy_dag.py]
  HermesDAG[airflow_docker/dags/hermes_strategy_dag.py]
  VeritasPushDAG[airflow_docker/dags/veritas_push_dag.py]

  %% === 戦略生成/評価 ===
  VeritasGenerate[src/veritas/veritas_generate_strategy.py]
  VeritasEval[src/veritas/evaluate_veritas.py]
  VeritasStrategyGen[src/veritas/strategy_generator.py]
  SimpleModel[src/veritas/models/ml_model/simple_model.py]

  %% === データ ===
  VeritasEvalLog[data/stats/veritas_eval_result.json]

  %% === 依存関係 ===
  KingRoutes --API/GUI呼び出し--> KingNoctria
  KingNoctria --評議会/意思決定--> VeritasMachina
  KingNoctria --評議会/意思決定--> PrometheusOracle
  KingNoctria --評議会/意思決定--> AurusSingularis
  KingNoctria --評議会/意思決定--> LeviaTempest
  KingNoctria --評議会/意思決定--> NoctusSentinella
  KingNoctria --評議会/意思決定--> HermesCognitor
  KingNoctria --DAGトリガー/統治API--> NoctriaKingdomDAG
  KingNoctria --DAGトリガー/統治API--> AurusDAG
  KingNoctria --DAGトリガー/統治API--> LeviaDAG
  KingNoctria --DAGトリガー/統治API--> PrometheusDAG
  KingNoctria --DAGトリガー/統治API--> NoctusDAG
  KingNoctria --DAGトリガー/統治API--> HermesDAG
  KingNoctria --DAGトリガー/統治API--> VeritasPushDAG
  VeritasMachina --CLI/評価ログ--> VeritasGenerate
  VeritasMachina --CLI/評価ログ--> VeritasEval
  VeritasMachina --生成・評価スクリプト--> VeritasStrategyGen
  VeritasMachina --評価ログ読込--> VeritasEvalLog
  VeritasEval --出力--> VeritasEvalLog
  VeritasStrategyGen --モデル--> SimpleModel
  PlanStatistics --評価ログdict/df--> AnomalyDetector
  PlanStatistics --コレクタdf--> PlanCollector
  PlanStatistics --特徴量--> FeatureEngineer
  Dashboard --統計/異常要約--> PlanStatistics
  Dashboard --異常要約--> AnomalyDetector
  PlanCollector --各種外部API/CSV--> PlanStatistics
  PDCA --統計/評価ログ--> PlanStatistics
  PDCARecheck --再評価API/DAG--> KingNoctria
  NoctriaKingdomDAG --コア判定/評議会--> KingNoctria
  NoctriaKingdomDAG --観測データ--> DataLoader
  DataLoader --API/履歴管理--> PlanCollector
  Logger --全体ロガー/violations--> All

  %% === データフロー/例 ===
  VeritasEvalLog --dict入力--> AnomalyDetector

  %% === コメント ===
  classDef main fill:#181f38,stroke:#5474b8,stroke-width:2px,color:#eee;
  class KingNoctria,VeritasMachina,PrometheusOracle,AurusSingularis,LeviaTempest,NoctusSentinella,HermesCognitor,NoctriaKingdomDAG main;

