# ðŸ—‚ ADRs â€” Architecture Decision Records (Index) / Noctria Kingdom

**Document Version:** 1.0  
**Status:** Adopted  
**Last Updated:** 2025-08-14 (JST)

> ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ **ADRsï¼ˆArchitecture Decision Recordsï¼‰** ã®ã€Œç´¢å¼•ã€ã¨ã€Œé‹ç”¨ãƒ«ãƒ¼ãƒ«ã€ã€Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚’æä¾›ã—ã¾ã™ã€‚  
> **æ³¨æ„:** æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã¯ *Coding Standards* ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¯ `../governance/Coding-Standards.md` ã‚’æ­£ã¨ã—ã¾ã™ã€‚

---

## 1) ç›®çš„ã¨é©ç”¨ç¯„å›²
- **ç›®çš„:** é‡è¦ãªæŠ€è¡“/é‹ç”¨ã®æ„æ€æ±ºå®šã‚’å°ã•ãã€è¿½è·¡å¯èƒ½ã«ã€å°†æ¥ã®èª­ã¿æ‰‹ã«ã‚‚å†ç¾ã§ãã‚‹å½¢ã§è¨˜éŒ²ã™ã‚‹ã€‚  
- **å¯¾è±¡:** ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€å¥‘ç´„/APIã€å¯è¦³æ¸¬æ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã€é‹ç”¨æ–¹å¼ï¼ˆAirflow/DAGï¼‰ã€ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ï¼ˆNoctusï¼‰ãªã©ã€‚  
- **éžå¯¾è±¡:** å˜ç´”ãªãƒã‚°ä¿®æ­£ã‚„æ˜Žç™½ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆãŸã ã—å½±éŸ¿ãŒåºƒã‘ã‚Œã° ADR åŒ–ã‚’æ¤œè¨Žï¼‰ã€‚

---

## 2) å½¢å¼ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- **å ´æ‰€:** `docs/adrs/`  
- **å‘½åè¦å‰‡:** `ADR-YYYYMMDD-xxxx-snake-case-title.md`  
  - `YYYYMMDD` ã¯æ±ºå®šæ—¥ã€`xxxx` ã¯ 4 æ¡ã®é€£ç•ªï¼ˆåŒæ—¥å†…ã§æ˜‡é †ï¼‰ã€‚  
  - ä¾‹: `ADR-20250814-0001-json-schema-as-contract.md`
- **ãƒªãƒ³ã‚¯:** ADR åŒå£«ã¯ç›¸äº’ã«ç›¸å¯¾ãƒ‘ã‚¹ã§ãƒªãƒ³ã‚¯ï¼ˆ`Supersedes:` / `Superseded-by:` ã‚’æ˜Žè¨˜ï¼‰ã€‚  
- **è¨€èªž:** æ—¥æœ¬èªžã‚’åŸºæœ¬ã€‚å¿…è¦ã«å¿œã˜ã¦çŸ­ã„è‹±èªžä½µè¨˜å¯ã€‚

---

## 3) ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ï¼ˆLifecycleï¼‰
- `Proposed` â†’ ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ï¼ˆPR ä¸Šã§è­°è«–ï¼‰  
- `Accepted` â†’ åˆæ„ã—æŽ¡ç”¨ã€‚å®Ÿè£…/é‹ç”¨ãƒ«ãƒ¼ãƒ«ã«åæ˜ ã€‚  
- `Rejected` â†’ æŽ¡ç”¨ã—ãªã„ã€‚ç†ç”±ã‚’è¨˜éŒ²ã€‚  
- `Deprecated` â†’ å°†æ¥ã®å»ƒæ­¢äºˆå®šã€‚ç§»è¡Œã‚¬ã‚¤ãƒ‰å¿…é ˆã€‚  
- `Superseded` â†’ å¾Œç¶š ADR ã«ç½®æ›ã€‚ãƒªãƒ³ã‚¯å¿…é ˆã€‚

---

## 4) ã„ã¤ ADR ã‚’æ›¸ãã‹ï¼ˆãƒˆãƒªã‚¬ï¼‰
- **å¥‘ç´„/API/ã‚¹ã‚­ãƒ¼ãƒž**ã®å¤‰æ›´ï¼ˆç‰¹ã« Breaking / `/v2` å°Žå…¥ï¼‰  
- **å¯è¦³æ¸¬æ€§**ã®åŸºæœ¬æ–¹é‡ï¼ˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ SoTã€ä¿æŒã€ã‚¢ãƒ©ãƒ¼ãƒˆåŸºæº–ï¼‰  
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ã‚¢ã‚¯ã‚»ã‚¹**ï¼ˆTwo-Person Gateã€Secrets é‹ç”¨ï¼‰  
- **é‹ç”¨æ–¹å¼**ï¼ˆAirflow ã‚­ãƒ¥ãƒ¼åˆ†é›¢ã€ãƒªãƒˆãƒ©ã‚¤/å†ªç­‰ï¼‰ã€**ãƒ‡ãƒ¼ã‚¿ä¿æŒ**  
- **å®Ÿè£…åŽŸå‰‡**ï¼ˆIdempotency-Key å¿…é ˆã€Correlation-ID è²«é€šã€Outbox ãƒ‘ã‚¿ãƒ¼ãƒ³ç­‰ï¼‰

> è¿·ã£ãŸã‚‰ **æ›¸ã**ã€‚çŸ­ãã¦ã‚‚è¨˜éŒ²ã™ã‚‹ã“ã¨ã«ä¾¡å€¤ãŒã‚ã‚Šã¾ã™ã€‚

---

## 5) ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ï¼‰
```md
# ADR-YYYYMMDD-xxxx â€” {çŸ­ã„æ±ºå®šã‚¿ã‚¤ãƒˆãƒ«}

**Status:** Proposed | Accepted | Rejected | Deprecated | Superseded  
**Date:** YYYY-MM-DD  
**Owners:** {role or people}  
**Supersedes:** ./ADR-YYYYMMDD-xxxx-*.md (ã‚ã‚Œã°)  
**Superseded-by:** ./ADR-YYYYMMDD-xxxx-*.md (ã‚ã‚Œã°)

## Context
- èƒŒæ™¯ãƒ»å•é¡Œãƒ»åˆ¶ç´„ãƒ»ä»£æ›¿æ¡ˆã‚’ç°¡æ½”ã«ã€‚é–¢é€£ Issue/PR/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆç›¸å¯¾ãƒªãƒ³ã‚¯ï¼‰:
  - ../architecture/Architecture-Overview.md
  - ../observability/Observability.md
  - ../operations/Config-Registry.md
  - ../apis/Do-Layer-Contract.md ãªã©

## Decision
- ä½•ã‚’æŽ¡ç”¨/å´ä¸‹ã™ã‚‹ã‹ã€**çŸ­ã„è¦ç‚¹**ã§ç¢ºå®šæ–‡ã€‚
- å½±éŸ¿ç¯„å›²ï¼ˆã‚³ãƒ¼ãƒ‰/é‹ç”¨/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ã‚¹ã‚­ãƒ¼ãƒžï¼‰ã‚‚åˆ—æŒ™ã€‚

## Consequences
- ãƒ—ãƒ©ã‚¹/ãƒžã‚¤ãƒŠã‚¹/ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã€‚
- é‹ç”¨å¤‰æ›´ï¼ˆRunbooks è¿½è¨˜ç‚¹ï¼‰ã€ç›£è¦–ãƒ»SLO ã¸ã®å½±éŸ¿ã€‚

## Rollout / Migration
- æ®µéšŽå°Žå…¥ï¼ˆ7%â†’30%â†’100%ï¼‰ã€ç§»è¡Œã‚¬ã‚¤ãƒ‰ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ã€‚
- äº’æ›æ€§ï¼ˆSemVer / `/v1` ä½µå­˜æœŸé™ï¼‰ã€ãƒ†ã‚¹ãƒˆ/å¥‘ç´„æ¤œè¨¼ã€‚

## References
- å‚è€ƒãƒªãƒ³ã‚¯ã€å‰æã¨ãªã‚‹ ADRã€å¤–éƒ¨æ¨™æº–/ä»•æ§˜ãªã©ã€‚
```

---

## 6) é‹ç”¨ãƒ«ãƒ¼ãƒ«ï¼ˆDocs-as-Codeï¼‰
- **PR åŒæ¢±:** ADR ã¯ **é–¢é€£ã‚³ãƒ¼ãƒ‰/è¨­å®š/Runbooks ã®å¤‰æ›´ã¨åŒä¸€ PR** ã§æå‡ºã€‚  
- **Two-Person Gate:** `risk_policy / flags / API / Do-Contract / Schemas` ã®é‡å¤§å¤‰æ›´ã¯ **äºŒäººæ‰¿èª + King**ã€‚  
- **SemVer:** å¥‘ç´„/ã‚¹ã‚­ãƒ¼ãƒžã¯å¾Œæ–¹äº’æ›ã‚’åŸºæœ¬ã€‚Breaking ã¯ `/v2` ã‚’ä½µå­˜ã€ç§»è¡Œã‚¬ã‚¤ãƒ‰å¿…é ˆï¼ˆ`Release-Notes.md` ã«æ˜Žè¨˜ï¼‰ã€‚  
- **å‚ç…§ã®ä¸€è²«æ€§:** ADR ã§æ±ºã‚ãŸå†…å®¹ã¯ã€`Architecture-Overview.md` / `Observability.md` / `Config-Registry.md` ç­‰ã¸å³åæ˜ ã€‚  
- **å¯è¦³æ¸¬æ€§:** æ±ºå®šã”ã¨ã«å¿…è¦ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹/ã‚¢ãƒ©ãƒ¼ãƒˆæ›´æ–°ã‚’ä¼´ã†å ´åˆã¯ `deploy/alerts/*` ã®å·®åˆ†ã‚’å«ã‚ã‚‹ã€‚

---

## 7) ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] **å•é¡Œè¨­å®šãŒæ˜Žç¢º**ï¼ˆèª°ãŒä½•ã«å›°ã£ã¦ã„ã‚‹ã‹ / åˆ¶ç´„ã¯ä½•ã‹ï¼‰  
- [ ] **é¸æŠžè‚¢ã®æ¯”è¼ƒ**ï¼ˆå°‘ãªãã¨ã‚‚ 2â€“3 æ¡ˆã®æ¤œè¨Žè·¡ï¼‰  
- [ ] **æ±ºå®š/éžæ±ºå®šã®å¢ƒç•ŒãŒæ˜Žç¢º**ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—å¤–ã¯æ˜Žè¨˜ï¼‰  
- [ ] **é‹ç”¨/ç›£è¦–/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¸ã®å½±éŸ¿**ãŒæ•´ç†ã•ã‚Œã¦ã„ã‚‹  
- [ ] **ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ/ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †**ãŒç¾å®Ÿçš„  
- [ ] **é–¢é€£æ–‡æ›¸/å¥‘ç´„ã®æ›´æ–°**ãŒåŒ PR ã«å«ã¾ã‚Œã‚‹  
- [ ] **Two-Person Gate** å¯¾è±¡ãªã‚‰æ‰¿èªè€…ãŒæƒã£ã¦ã„ã‚‹

---

## 8) ç›´è¿‘ã®é‡è¦ãƒˆãƒ”ãƒƒã‚¯ï¼ˆADR å€™è£œ / æ—¢æ±ºã®æ˜Žæ–‡åŒ–ï¼‰
> ã¾ã å€‹åˆ¥ ADR ãŒãªã„ã‚‚ã®ã¯ **å€™è£œ**ã¨ã—ã¦åˆ—æŒ™ã€‚é †æ¬¡ ADR åŒ–ã—ã¾ã™ã€‚

- **ADR-20250814-0001 â€” JSON Schema ã‚’å…¬å¼å¥‘ç´„ã¨ã— SemVer é‹ç”¨**ï¼ˆ/api/v1ã€Breaking ã¯ /v2 ä½µå­˜ï¼‰ã€å€™è£œã€‘  
- **ADR-20250814-0002 â€” Idempotency-Key ã®æ›¸ãè¾¼ã¿ç³»å¿…é ˆåŒ–ï¼ˆ24h å†ªç­‰ï¼‰**ã€å€™è£œã€‘  
- **ADR-20250814-0003 â€” Correlation-IDï¼ˆtrace_idï¼‰ã® Pâ†’Dâ†’Exec è²«é€š**ï¼ˆ`X-Trace-Id` / DB obs_*ï¼‰ã€å€™è£œã€‘  
- **ADR-20250814-0004 â€” Noctus Gate ã‚’ Do å±¤ã®å¼·åˆ¶å¢ƒç•Œã¨ã—ã¦é©ç”¨**ï¼ˆãƒã‚¤ãƒ‘ã‚¹ç¦æ­¢ï¼‰ã€å€™è£œã€‘  
- **ADR-20250814-0005 â€” Observability SoTï¼ˆobs_* ãƒ†ãƒ¼ãƒ–ãƒ« + ãƒ­ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—æ–¹é‡ï¼‰**ã€å€™è£œã€‘  
- **ADR-20250814-0006 â€” æ®µéšŽå°Žå…¥æ›²ç·š 7%â†’30%â†’100% ã‚’æ¨™æº–åŒ–**ï¼ˆSafemode ä½µç”¨ï¼‰ã€å€™è£œã€‘  
- **ADR-20250814-0007 â€” DO å±¤ã® Outbox + Idempotency-Key ã§å°‘ãªãã¨ã‚‚ã€Œonceã€ä¿è¨¼**ã€å€™è£œã€‘  
- **ADR-20250814-0008 â€” å†…éƒ¨æ™‚åˆ»ã¯ UTC å›ºå®š / è¡¨ç¤ºã¯ GUI ã§ TZ è£œæ­£**ã€å€™è£œã€‘  
- **ADR-20250814-0009 â€” Airflow ã‚­ãƒ¥ãƒ¼åˆ†é›¢ï¼ˆcritical_do / modelsï¼‰ã¨ SLO**ã€å€™è£œã€‘

> ä¸Šè¨˜ã¯ `Architecture-Overview.md` / `Observability.md` / `Runbooks.md` ç­‰ã«æ—¢ã«è¨˜è¿°ãŒã‚ã‚Šã€**ADR ã¨ã—ã¦ã®å˜ä½“è¨˜éŒ²**ã‚’è¿½åŠ äºˆå®šã§ã™ã€‚

---

## 9) æ—¢å­˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®é–¢ä¿‚ï¼ˆCross-Refsï¼‰
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: `../architecture/Architecture-Overview.md`, `../architecture/Plan-Layer.md`  
- é‹ç”¨: `../operations/Runbooks.md`, `../operations/Airflow-DAGs.md`, `../operations/Config-Registry.md`  
- å¥‘ç´„/API: `../apis/API.md`, `../apis/Do-Layer-Contract.md`  
- å¯è¦³æ¸¬æ€§: `../observability/Observability.md`  
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: `../security/Security-And-Access.md`  
- QA: `../qa/Testing-And-QA.md`  
- è¨ˆç”»: `../roadmap/Roadmap-OKRs.md`, `../roadmap/Release-Notes.md`

---

## 10) ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰
- **Q:** Issue/PR ã®è­°è«–ã¨ä½•ãŒé•ã†ï¼Ÿ  
  **A:** ADR ã¯**æ±ºå®šã®æœ€çµ‚å½¢**ã¨**ç†ç”±**ã‚’å°†æ¥ã«æ®‹ã™æ°¸ä¹…è¨˜éŒ²ã€‚è­°è«–ãƒ­ã‚°ã¯æ•£é€¸ã—ãŒã¡ã€‚  
- **Q:** å°ã•ãªå¤‰æ›´ã§ã‚‚å¿…è¦ï¼Ÿ  
  **A:** å½±éŸ¿ãŒåºƒã„/æˆ»ã—ã«ãã„/å¥‘ç´„ã‚„é‹ç”¨æ–¹é‡ã«è§¦ã‚Œã‚‹ãªã‚‰ ADR ã‚’æŽ¨å¥¨ã€‚  
- **Q:** æ—¢å­˜ã®æš—é»™ã®æ–¹é‡ã¯ï¼Ÿ  
  **A:** ä»Šå¾Œã®å¤‰æ›´æ™‚ã«**ç¢ºå®šæƒ…å ±ã¨ã—ã¦ ADR åŒ–**ã€‚å¾Œè¿½ã„ ADR ã‚‚ä¾¡å€¤ãŒã‚ã‚Šã¾ã™ã€‚

---

## 11) ä½œæˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆä»»æ„ï¼‰
```bash
# æ–°è¦ ADR ä½œæˆã®é››å½¢å‡ºåŠ›ä¾‹
d=docs/adrs && today=$(date +%Y%m%d) && seq=0001 && \
cat > $d/ADR-${today}-${seq}-short-title.md <<'EOF'
# ADR-YYYYMMDD-xxxx â€” {çŸ­ã„æ±ºå®šã‚¿ã‚¤ãƒˆãƒ«}

**Status:** Proposed  
**Date:** YYYY-MM-DD  
**Owners:** {role or people}

## Context
...

## Decision
...

## Consequences
...

## Rollout / Migration
...

## References
...
EOF
```

---

## 12) å¤‰æ›´å±¥æ­´
- **2025-08-14:** v1.0 åˆç‰ˆï¼ˆç´¢å¼•/é‹ç”¨ãƒ«ãƒ¼ãƒ«/ãƒ†ãƒ³ãƒ—ãƒ¬/å€™è£œä¸€è¦§ï¼‰ã€‚  
  æ—§å†…å®¹ã« *Coding Standards* ãŒå«ã¾ã‚Œã¦ã„ãŸãŸã‚ã€è©²å½“å†…å®¹ã¯ `../governance/Coding-Standards.md` ã‚’æ­£ã¨ã™ã‚‹æ–¹é‡ã‚’æ˜Žè¨˜ã€‚
