<!-- ================================================================== -->
<!-- FILE: docs/apis/Do-Layer-Contract.md -->
<!-- ================================================================== -->
# ⚔️ Do-Layer Contract — Order/Execution/Audit（決定版）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/architecture/diagrams/do_layer_contract.mmd title="Do-Layer Contract（最新）" fence=mermaid -->
### Do-Layer Contract（最新）

<!-- Missing: docs/architecture/diagrams/do_layer_contract.mmd -->
<!-- AUTODOC:END -->

<!-- AUTODOC:BEGIN mode=git_log path_globs="src/core/risk_control.py;src/execution/**/*.py" title="Do層 契約/実装更新履歴（最近30）" limit=30 since=2025-08-01 -->
### Do層 契約/実装更新履歴（最近30）

- **b1453a0** 2025-08-13T16:03:47+09:00 — Update order_execution.py (by Noctoria)
  - `src/execution/order_execution.py`
- **9ed85b3** 2025-08-13T15:53:16+09:00 — Update risk_policy.py (by Noctoria)
  - `src/execution/risk_policy.py`
- **fba6dda** 2025-08-13T15:24:26+09:00 — Update risk_gate.py (by Noctoria)
  - `src/execution/risk_gate.py`
- **112e173** 2025-08-13T15:18:00+09:00 — Create risk_policy.py (by Noctoria)
  - `src/execution/risk_policy.py`
- **e29e4bb** 2025-08-13T12:50:28+09:00 — Create risk_gate.py (by Noctoria)
  - `src/execution/risk_gate.py`
- **06e96bd** 2025-08-08T00:44:01+09:00 — Update order_execution.py (by Noctoria)
  - `src/execution/order_execution.py`
- **555064f** 2025-08-08T00:36:14+09:00 — Update optimized_order_execution.py (by Noctoria)
  - `src/execution/optimized_order_execution.py`
- **a42d51e** 2025-08-08T00:23:43+09:00 — Update order_execution.py (by Noctoria)
  - `src/execution/order_execution.py`
<!-- AUTODOC:END -->

**Version:** 1.0  
**Status:** Adopted  
**Last Updated:** 2025-08-12 (JST)

> 目的：Plan→Do→Check の境界で用いる **発注（Order）/約定（Execution）/監査（Audit）/リスクイベント（Risk Event）** の I/F を固定し、  
> **安全（Noctus 境界）/再現性（Idempotent）/完全監査（WORM）** を保証する。  
> 参照：`../apis/API.md` / `../observability/Observability.md` / `../qa/Testing-And-QA.md` / `../security/Security-And-Access.md`

---

## 1) スコープ & 原則
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/01_scope_principles.md title="スコープ & 原則（最新）" -->
(自動置換)
<!-- AUTODOC:END -->
## 2) フロー（概観）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/02_flow_overview.md title=フロー（概観） -->
(自動置換)
<!-- AUTODOC:END -->
## 3) エンティティ（Schemas）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/03_entities_schemas.md title=エンティティ（Schemas） -->
(自動置換)
<!-- AUTODOC:END -->
## 4) `order_request`（Plan → Do）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/04_order_request.md title="`order_request`（Plan → Do）" -->
(自動置換)
<!-- AUTODOC:END -->
## 5) `exec_result`（Do → Check）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/05_exec_result.md title="`exec_result`（Do → Check）" -->
(自動置換)
<!-- AUTODOC:END -->
## 6) `audit_order`（WORM 監査）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/06_audit_order.md title="`audit_order`（WORM 監査）" -->
(自動置換)
<!-- AUTODOC:END -->
## 7) 数値精度・丸め（Financial Correctness）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/07_financial_correctness.md title="数値精度・丸め（Financial Correctness）" -->
(自動置換)
<!-- AUTODOC:END -->
## 8) Idempotency / Concurrency
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/08_idempotency_concurrency.md title="Idempotency / Concurrency" -->
(自動置換)
<!-- AUTODOC:END -->
## 9) エラーコード（対照表）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/09_error_codes.md title=エラーコード（対照表） -->
(自動置換)
<!-- AUTODOC:END -->
## 10) サンプル（テスト用最小セット）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/10_samples_min.md title=サンプル（テスト用最小セット） -->
(自動置換)
<!-- AUTODOC:END -->
## 11) 契約テスト（CI 要件）
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/11_contract_tests.md title="契約テスト（CI 要件）" -->
(自動置換)
<!-- AUTODOC:END -->
## 12) 変更履歴
<!-- AUTODOC:BEGIN mode=file_content path_globs=docs/_partials/apis/Do-Layer-Contract/12_changelog.md title=変更履歴 -->
(自動置換)
<!-- AUTODOC:END -->
