flowchart TD

%% GUI/API (Blue)
subgraph GUI_API["ðŸ–¥ï¸ GUIãƒ»APIãƒ»å¤–éƒ¨é€£æº"]
direction TB
style GUI_API fill:#E8F4FD,stroke:#0369A1,stroke-width:2px
DASHBOARD["dashboard.py\nçµ±æ²»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"]
PDCA_PANEL["pdca.py\nPDCAç®¡ç†"]
AI_PANEL["ai_routes.py\nAIä¸€è¦§ãƒ»è©³ç´°"]
TRIGGER_PANEL["trigger.py\nçŽ‹å‘½ãƒ»çµ±æ²»ã‚³ãƒžãƒ³ãƒ‰"]
API["å¤–éƒ¨APIãƒ»ãƒãƒƒãƒ\nè‡ªå‹•çµ±æ²»é€£æº"]
end

%% ä¸­å¤®çµ±æ²»AI (Gold)
subgraph KINGDOM["ðŸ‘‘ ä¸­å¤®çµ±æ²»AIã‚¯ãƒ©ã‚¹ã‚¿"]
direction TB
style KINGDOM fill:#FFF8E6,stroke:#D97706,stroke-width:2px
NOCTRIA["king_noctria.py\nçŽ‹Noctriaï¼ˆæœ€çµ‚æ„æ€æ±ºå®šAIï¼‰"]
HERMES["hermes_cognitor.py\nHermesï¼ˆLLMç”Ÿæˆãƒ»èª¬æ˜ŽAIï¼‰"]
VERITAS["veritas_machina.py\nVeritasï¼ˆMLè©•ä¾¡AIï¼‰"]
AURUS["aurus.py\nå¸‚å ´è¨­è¨ˆAI"]
LEVIA["levia.py\né«˜é€Ÿå®Ÿè¡ŒAI"]
NOCTUS["noctus.py\nãƒªã‚¹ã‚¯ç®¡ç†AI"]
PROMETHEUS["prometheus.py\næœªæ¥äºˆæ¸¬AI"]
end

%% Airflow DAGç¾¤ (Light Purple)
subgraph DAGS["âš™ï¸ Airflow DAGç¾¤"]
direction TB
style DAGS fill:#F3E8FF,stroke:#7C3AED,stroke-width:2px
GEN_DAG["veritas_generate_dag.py\næˆ¦ç•¥ç”ŸæˆDAG"]
EVAL_DAG["veritas_eval_dag.py\nä¸€æ‹¬è©•ä¾¡DAG"]
RECHECK_DAG["veritas_recheck_dag.py\nå†è©•ä¾¡DAG"]
ACT_DAG["veritas_act_record_dag.py\nActè¨˜éŒ²DAG"]
PUSH_DAG["veritas_push_dag.py\nPushæŽ¡ç”¨DAG"]
REPLAY_DAG["veritas_replay_dag.py\nReplayå†ç¾DAG"]
end

%% ãƒ‡ãƒ¼ã‚¿ç®¡ç† (Light Green)
subgraph DATA["ðŸ“š ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ­ã‚°ãƒ»ã‚µãƒžãƒªå±¤"]
direction TB
style DATA fill:#E6FFFA,stroke:#10B981,stroke-width:2px
STRATEGY_JSON["hermes_generated\nHermesæˆ¦ç•¥json"]
EVALRES_JSON["data/stats/*.json\nè©•ä¾¡çµæžœjson"]
ACTLOG_JSON["act_logs/adopted\næŽ¡ç”¨ãƒ­ã‚°json"]
RECHECK_JSON["act_logs/rechecked\nå†è©•ä¾¡ãƒ­ã‚°"]
REPLAY_JSON["act_logs/replayed\nå†é€ãƒ­ã‚°"]
PLAN_SUMMARY_JSON["pdca_plan_summary.json\nPlanã‚µãƒžãƒª"]
ORACLE_FORECAST_JSON["oracle_forecast.json\næœªæ¥äºˆæ¸¬json"]
end

%% åˆ†æžãƒ»LLM APIå±¤ (Light Orange)
subgraph PLAN_LLM["ðŸ§  åˆ†æžãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ»LLM API"]
direction TB
style PLAN_LLM fill:#FFF7ED,stroke:#F97316,stroke-width:2px
PLAN_COLLECT["plan_data/collector.py\nãƒ‡ãƒ¼ã‚¿åŽé›†"]
PLAN_FEATURE["plan_data/features.py\nç‰¹å¾´é‡ç”Ÿæˆ"]
PLAN_STAT["plan_data/statistics.py\næŒ‡æ¨™ãƒ»é›†è¨ˆ"]
PLAN_ANALYZER["plan_data/analyzer.py\nè¦å› åˆ†æž"]
PLAN_ANOMALY["plan_data/anomaly_detector.py\nç•°å¸¸æ¤œçŸ¥"]
LLM_PROMPT["llm/llm_prompt_builder.py\nãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ"]
LLM_EVALAPI["llm/veritas_eval_api.py\nè©•ä¾¡API"]
PLAN_PDCA_BATCH["plan_data/run_pdca_plan_workflow.py\nPDCAãƒãƒƒãƒ"]
end

%% --- Connectionsï¼ˆä¸Šã‹ã‚‰ä¸‹ã¸ç¸¦æ–¹å‘ã‚’å¼·èª¿ï¼‰---

%% GUI/API â†’ çŽ‹Noctria
DASHBOARD --> NOCTRIA
PDCA_PANEL --> NOCTRIA
AI_PANEL --> NOCTRIA
TRIGGER_PANEL --> NOCTRIA
API --> NOCTRIA

%% çŽ‹Noctria â†’ å„AI
NOCTRIA --> HERMES
NOCTRIA --> VERITAS
NOCTRIA --> AURUS
NOCTRIA --> LEVIA
NOCTRIA --> NOCTUS
NOCTRIA --> PROMETHEUS

%% AI â†’ DAGç¾¤
HERMES --> GEN_DAG
VERITAS --> EVAL_DAG
VERITAS --> RECHECK_DAG
AURUS --> GEN_DAG
LEVIA --> GEN_DAG
NOCTUS --> EVAL_DAG
PROMETHEUS --> EVAL_DAG
NOCTRIA --> ACT_DAG
NOCTRIA --> PUSH_DAG
NOCTRIA --> REPLAY_DAG

%% DAGç¾¤ â†’ ãƒ‡ãƒ¼ã‚¿å±¤
GEN_DAG --> STRATEGY_JSON
EVAL_DAG --> EVALRES_JSON
RECHECK_DAG --> RECHECK_JSON
ACT_DAG --> ACTLOG_JSON
PUSH_DAG --> ACTLOG_JSON
REPLAY_DAG --> REPLAY_JSON

%% ãƒ‡ãƒ¼ã‚¿å±¤ â†’ çŽ‹Noctria & GUI
STRATEGY_JSON --> NOCTRIA
EVALRES_JSON --> NOCTRIA
RECHECK_JSON --> NOCTRIA
ACTLOG_JSON --> NOCTRIA
REPLAY_JSON --> NOCTRIA
PLAN_SUMMARY_JSON --> DASHBOARD
ORACLE_FORECAST_JSON --> NOCTRIA

%% åˆ†æžãƒ»LLMå±¤å†…é€£æº
PLAN_COLLECT --> PLAN_FEATURE
PLAN_FEATURE --> PLAN_STAT
PLAN_STAT --> PLAN_ANALYZER
PLAN_STAT --> PLAN_ANOMALY
PLAN_ANALYZER --> LLM_PROMPT
PLAN_ANOMALY --> LLM_PROMPT
LLM_PROMPT --> HERMES
LLM_EVALAPI --> VERITAS
PLAN_PDCA_BATCH --> PLAN_SUMMARY_JSON

%% PROMETHEUSâ†’æœªæ¥äºˆæ¸¬
PROMETHEUS --> ORACLE_FORECAST_JSON

%% çµ±æ²»å±¥æ­´ â†’ GUI
NOCTRIA --> DASHBOARD
NOCTRIA --> PDCA_PANEL
