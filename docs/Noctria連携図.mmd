flowchart TD  

%% --- Veritas PDCAãƒ©ã‚¤ãƒ³ï¼ˆå½¹å‰²å†æ•´ç†å¾Œï¼‰ ---
subgraph Veritas_PDCA[Veritas PDCAçµ±åˆãƒ©ã‚¤ãƒ³]
  VG["veritas_generate_dag.py<br>ğŸ“¦ æˆ¦ç•¥è©•ä¾¡ãƒ»é¸å®šï¼ˆMLè©•ä¾¡ï¼‰"]
  VA["veritas_act_record_dag.py<br>ğŸ—’ï¸ æ¡ç”¨æˆ¦ç•¥è¨˜éŒ²"]
  VPUSH["veritas_push_dag.py<br>â¬†ï¸ GitHubã¸Push"]
  VREPLAY["veritas_replay_dag.py<br>ğŸ” ãƒ­ã‚°å†é€ï¼ˆPDCAä¸€éƒ¨ï¼‰"]
end

%% --- Kingdom çµ±æ²»AIå±¤ ---
subgraph Kingdomçµ±æ²»AI[Noctria çµ±æ²»å±¤]
  RC["noctria_royal_council_dag.py<br>ğŸ‘‘ å¾¡å‰ä¼šè­°DAGï¼ˆå…¨AIé›†ç´„ï¼‰"]
  KING["core/king_noctria.py<br>çµ±æ²»AIï¼ˆæœ€çµ‚æ„æ€æ±ºå®šï¼‰"]
end

%% --- è‡£ä¸‹AIç¾¤ï¼ˆæ˜ç¢ºãªå½¹å‰²åˆ†æ‹…ï¼‰ ---
subgraph è‡£ä¸‹AIç¾¤[å„å°‚é–€AIãƒ»æœªæ¥äºˆæ¸¬ãƒ»ãƒªã‚¹ã‚¯è©•ä¾¡]
  PA["prometheus_strategy_dag.py<br>ğŸ”® æœªæ¥äºˆæ¸¬"]
  AA["aurus_strategy_dag.py<br>ğŸ¯ å¸‚å ´ç·åˆåˆ†æ"]
  LA["levia_strategy_dag.py<br>âš¡ ã‚¹ã‚­ãƒ£ãƒ«ãƒ”ãƒ³ã‚°"]
  NA["noctus_strategy_dag.py<br>ğŸ›¡ï¸ ãƒªã‚¹ã‚¯è©•ä¾¡"]
  HA["hermes_strategy_dag.py<br>ğŸ¦‰ æˆ¦ç•¥èª¬æ˜ï¼ˆLLMï¼‰"]
end

%% --- Hermes LLMç”Ÿæˆå±¤ï¼ˆæˆ¦ç•¥ãƒ»èª¬æ˜ç‰¹åŒ–ï¼‰ ---
subgraph Hermes_LLM[Hermes Cognitor LLMç”Ÿæˆå±¤]
  HGEN["hermes/strategy_generator.py<br>ğŸ¦‰ æˆ¦ç•¥ç”Ÿæˆï¼ˆLLMï¼‰"]
end

%% --- LLMå±¤ï¼ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆç‰¹åŒ–ï¼‰ ---
subgraph LLMå±¤[llm/ - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆï¼†ãƒ­ã‚°API]
  LLM_PROMPT["llm/llm_prompt_builder.py<br>ğŸ“œ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ"]
  LLM_EVALAPI["llm/veritas_eval_api.py<br>ğŸ“„ è©•ä¾¡ãƒ­ã‚°API"]
end

%% --- Plan Dataå±¤ï¼ˆãƒ‡ãƒ¼ã‚¿åˆ†æç‰¹åŒ–ï¼‰---
subgraph PlanData[plan_data/ - ãƒ‡ãƒ¼ã‚¿åˆ†æç‰¹åŒ–]
  PLAN_COLLECT["collector.py<br>ãƒ‡ãƒ¼ã‚¿åé›†"]
  PLAN_FEATURE["features.py<br>ç‰¹å¾´é‡ç”Ÿæˆ"]
  PLAN_STAT["statistics.py<br>æŒ‡æ¨™/é›†è¨ˆ"]
  PLAN_ANALYZER["analyzer.py<br>è¦å› åˆ†æ"]
  PLAN_ANOMALY["anomaly_detector.py<br>ç•°å¸¸æ¤œçŸ¥"]
  PLAN_PDCA_BATCH["run_pdca_plan_workflow.py<br>ğŸ› ï¸ ã‚µãƒãƒªãƒ¼è‡ªå‹•ç”Ÿæˆ"]
end

%% --- GUI/APIå±¤ï¼ˆå½¹å‰²åˆ†é›¢æ˜ç¢ºåŒ–ï¼‰ ---
subgraph GUI_API[GUIãƒ»APIãƒ»å¤–éƒ¨é€£æº]
  GUI["FastAPI/Streamlit<br>ğŸ–¥ï¸ æ‰‹å‹•æ“ä½œ"]
  API["å¤–éƒ¨APIãƒˆãƒªã‚¬ãƒ¼<br>ğŸ”— è‡ªå‹•é€£æº"]
end

%% --- ãƒ‡ãƒ¼ã‚¿æ ¼ç´å±¤ï¼ˆç”¨é€”åˆ¥ACTãƒ­ã‚°æ•´ç†ï¼‰ ---
subgraph DATA["data/ - ãƒ‡ãƒ¼ã‚¿ç®¡ç†å±¤"]
  GIT["GitHub<br>ğŸ“¦ æˆ¦ç•¥ãƒªãƒã‚¸ãƒˆãƒª"]
  ACTLOG_ADOPT["act_logs/adopted<br>ğŸ“œ æ¡ç”¨æˆ¦ç•¥ãƒ­ã‚°"]
  ACTLOG_RECHECK["act_logs/rechecked<br>ğŸ” å†è©•ä¾¡ãƒ­ã‚°"]
  ACTLOG_REPLAY["act_logs/replayed<br>ğŸ” å†é€ãƒ­ã‚°"]
  HERMES_STRAT["hermes_generated<br>ğŸ¦‰ Hermesæˆ¦ç•¥ç¾¤"]
  EVALRES["data/stats/*.json<br>ğŸ“Š æˆ¦ç•¥è©•ä¾¡çµæœ"]
  PLAN_SUMMARY_JSON["pdca_plan_summary.json<br>ğŸ“ Planã‚µãƒãƒªãƒ¼"]
  ORACLE_FORECAST_JSON["oracle_forecast.json<br>ğŸ”® æœªæ¥äºˆæ¸¬çµæœ"]
end

%% --- çµ±åˆãƒ•ãƒ­ãƒ¼ï¼ˆã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰ ---
HGEN --> HERMES_STRAT --> VG
VG --> EVALRES
EVALRES --> VA --> ACTLOG_ADOPT --> VPUSH --> GIT

%% --- è‡£ä¸‹AIã‹ã‚‰å¾¡å‰ä¼šè­°ã¸ä¸€å…ƒåŒ– ---
PA & AA & LA & NA & HA --> RC
RC --> KING

%% --- Kingã¯å¾¡å‰ä¼šè­°çµŒç”±ã§ã®ã¿åˆ¤æ–­ ---
KING --> GUI
ORACLE_FORECAST_JSON --> RC

%% --- GUI/APIã«ã‚ˆã‚‹PDCAæ“ä½œ ---
GUI & API --> VG

%% --- PlanData â†’ LLMå±¤ã§æ˜ç¢ºã«æ•´ç† ---
PLAN_COLLECT --> PLAN_FEATURE --> PLAN_STAT
PLAN_STAT --> PLAN_ANALYZER & PLAN_ANOMALY
PLAN_ANALYZER & PLAN_ANOMALY --> LLM_PROMPT
LLM_PROMPT --> PLAN_PDCA_BATCH
PLAN_PDCA_BATCH --> PLAN_SUMMARY_JSON --> GUI

%% --- LLMè©•ä¾¡API â†’ Veritasã§ç›´æ¥æ´»ç”¨ ---
LLM_EVALAPI --> VG

%% --- å†é€ã‚’PDCAçµ±åˆ ---
VREPLAY --> ACTLOG_REPLAY --> VG

%% --- ã‚¯ãƒ©ã‚¹ãƒ»è‰²å®šç¾© ---
classDef pdca fill:#f9f9cc,stroke:#e9c900,stroke-width:2px;
class VG,VA,VPUSH,VREPLAY pdca;

classDef gui fill:#d8eafd,stroke:#2c6faa,stroke-width:2px;
class GUI,API gui;

classDef data fill:#e2ffd8,stroke:#09a509,stroke-width:1.5px;
class GIT,ACTLOG_ADOPT,ACTLOG_RECHECK,ACTLOG_REPLAY,HERMES_STRAT,EVALRES,PLAN_SUMMARY_JSON,ORACLE_FORECAST_JSON data;

classDef llm fill:#f1e8ff,stroke:#9651ed,stroke-width:2px;
class LLM_PROMPT,LLM_EVALAPI llm;

classDef hermes fill:#e1f4ff,stroke:#2d9fc2,stroke-width:2px;
class HA,HGEN hermes;

classDef kingdom fill:#ffe6cc,stroke:#cc7a00,stroke-width:2px;
class KING,RC kingdom;
