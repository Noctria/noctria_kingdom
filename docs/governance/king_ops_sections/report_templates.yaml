# =======================================================
# ãƒ¬ãƒãƒ¼ãƒˆæ›¸å¼ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆå†ç¾ãƒ•ãƒƒã‚¿ãƒ¼è¿½è¨˜ï¼‰
# =======================================================
report_templates:
  conventions:
    writing_style:
      tone: "ç°¡æ½”ãƒ»äº‹å®Ÿãƒ™ãƒ¼ã‚¹ãƒ»å‘½ä»¤å½¢ï¼ˆç‹ã®è¨“ç¤ºï¼‰ã€‚ä¸»è¦³ã¯é¿ã‘ã€æ•°å€¤â†’æ ¹æ‹ â†’å‘½ä»¤ã®é †ã€‚"
      bullets_max: 5
      orders_max: 3
      emoji_policy:
        allow: true
        guide: ["è­¦å ±: ğŸ””","è¨“ç¤º/å‘½ä»¤: ğŸ“£","ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ: âœ…"]
    notations:
      arrow_delta: { up: "â¬†", down: "â¬‡", flat: "â†’" }
      kpi_keys: ["brier_score","ece_calibration","adversarial_pass_rate"]
      baseline_format: "{win}r {stat}"
      date_format: "YYYY-MM-DD"
    links:
      change_dir: "docs/change/"
      decisions_dir: "docs/decisions/"
  # å…±é€šã®å†ç¾ãƒ•ãƒƒã‚¿ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆdaily/weekly/monthly ã§å±•é–‹ï¼‰
  repro_fields:
    - "git_sha"
    - "data_snapshot_id"
    - "model_ver"
    - "seed"
    - "temperature_T"
    - "bins"

  daily:
    path: "docs/reports/daily/{YYYY-MM-DD}.md"
    front_matter:
      - "title: 'Daily Report â€” {date}'"
      - "tags: ['daily','kpi','noctria']"
    sections:
      - id: "header"
        title: "# Daily Report â€” {date}"
        body: |
          ç”Ÿæˆ: {utc_time} UTC / æ‹…å½“: ç‹
      - id: "exec_summary"
        title: "## Executive Summaryï¼ˆ1åˆ†ï¼‰"
        body: |
          - ä»Šæ—¥ã®çµè«–: **{today_conclusion_one_line}**
          - è­¦å ±: {alerts_brief}
          - æŒ‡æ¨™: Brier {brier_latest:.3f} / ECE {ece_latest:.3f} / Adv {adv_latest:.2f}
          - ç‹ã®è¨“ç¤ºï¼ˆè¦æ—¨ï¼‰: {orders_brief_one_line}
          - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: {next_actions_one_line}ï¼ˆç· åˆ‡ {deadline_or_dash}ï¼‰
      - id: "kpi_snapshot"
        title: "## KPI Snapshot (last {runs} runs)"
        body: |
          | metric | latest | baseline({baseline_label}) | Î” (signed) |
          |---|---:|---:|---:|
          | Brier | {brier_latest:.4f} | {brier_base_txt} | {brier_dev_signed} |
          | ECE   | {ece_latest:.4f}   | {ece_base_txt}   | {ece_dev_signed} |
          | Adv.Pass | {adv_latest:.4f} | {adv_base_txt} | {adv_dev_signed} |
          <details><summary>runs</summary>

          | run_id | at | brier | ece | adv_pass | samples |
          |---|---|---:|---:|---:|---:|
          {runs_table_rows}
          </details>
      - id: "alerts"
        title: "## ğŸ”” è­¦å ±"
        body: |
          {if_any_alerts}
          - **{level}** [{metric}] value={value:.4f} baseline({baseline_label})={baseline:.4f} dev={deviation_signed} consec={consecutive}
            - åŸå› ä»®èª¬: **{triage_category}**ï¼ˆæ ¹æ‹ : {triage_evidence_short}ï¼‰
            - åˆæœŸå¯¾å¿œ: {initial_action}
          {endif}
          {if_no_alerts}
          - æ¤œå‡ºãªã—ï¼ˆå…¨æŒ‡æ¨™ã§å®‰å®šï¼‰
          {endif}
      # è­¦å ±ã®è¡¨å½¢å¼ï¼ˆå¤šæ•°åŒæ™‚ç™ºç«æ™‚ã«åˆ‡æ›¿å¯èƒ½ï¼‰
      - id: "alerts_table"
        title: "## ğŸ”” è­¦å ±ï¼ˆè¡¨å½¢å¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"
        body: |
          | metric | level | value | baseline | dev | consec | ä»®èª¬ | åˆæœŸå¯¾å¿œ |
          |---|---|---:|---:|---:|---:|---|---|
          {alerts_table_rows}
      - id: "orders"
        title: "## ğŸ“£ ç‹ã®è¨“ç¤ºï¼ˆOrdersï¼‰"
        body: |
          1) {order_1}
          2) {order_2}
          3) {order_3}
          æˆåŠŸæ¡ä»¶: {success_criteria_line}
      - id: "whale_watch"
        title: "## Whale Watch"
        body: |
          - è¦³æ¸¬æœŸé–“: {ww_window}
          - æ¤œçŸ¥ä»¶æ•°: {ww_count}
          - ä»£è¡¨ä¾‹: {ww_top_events}
          - ãƒªã‚¹ã‚¯è©•ä¾¡: {ww_risk_brief}
          - å¯¾å¿œ: {ww_orders_one_line}
      - id: "slo_burn"
        title: "## SLO Burn-rate"
        body: |
          - predict p95: value={p95_ms} / SLO={slo_p95_ms} â†’ burn={burn_p95} {burn_p95_emoji}
          - availability: value={avail_pct} / SLO={slo_avail_pct} â†’ burn={burn_avail} {burn_avail_emoji}
          - ç›´è¿‘FTç· åˆ‡: value={ft_ready_utc} / SLO={slo_ft_deadline} â†’ burn={burn_ft} {burn_ft_emoji}
          - è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: {auto_actions_taken_or_none}
      - id: "handover"
        title: "## Handoverï¼ˆç¿Œæ—¥ï¼‰"
        body: |
          - é‡ç‚¹: {focus_one_line}
          - ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ: {checkpoint_1}, {checkpoint_2}
          - ã‚¿ã‚¹ã‚¯: {task_1_time} {task_1}, {task_2_time} {task_2}
      - id: "log_refs"
        title: "## å‚ç…§"
        body: |
          - decision_log: {decision_log_path_or_dash}
          - change_draft: {change_draft_path_or_dash}
          - kpi_db_view: obs_codex_kpi_latest
      - id: "repro_footer"
        title: "## Reproducibility"
        body: |
          - git_sha: `{git_sha}`
          - data_snapshot_id: `{data_snapshot_id}`
          - model_ver: `{model_ver}`
          - seed: `{seed}`
          - temperature_T: `{temperature_T}`
          - bins: `{bins}`

    acceptance_checklist:
      - "KPIã®æœ€æ–°å€¤ãƒ»åŸºæº–ãƒ»ç¬¦å·ä»˜ãåå·®ãŒè¡¨ã¨ã—ã¦è¼‰ã£ã¦ã„ã‚‹"
      - "è­¦å ±ã®æœ‰ç„¡ãŒæ˜ç¢ºã§ã€triage ã¨åˆæœŸå¯¾å¿œãŒä½µè¨˜"
      - "ç‹ã®è¨“ç¤ºãŒæœ€å¤§3ç‚¹ã§ã€æˆåŠŸæ¡ä»¶ãŒ1è¡Œ"
      - "handover ã«ç¿Œæ—¥ã®æ™‚åˆ»ä»˜ãã‚¿ã‚¹ã‚¯ãŒæœ€ä½2ä»¶"
      - "decision_log / change_draft ã®å‚ç…§ãŒè¨˜è¼‰"
      - "Reproducibility ãƒ•ãƒƒã‚¿ãƒ¼ãŒåŸ‹ã¾ã£ã¦ã„ã‚‹"

  weekly:
    path: "docs/reports/weekly/{YYYY}-W{WW}.md"
    front_matter:
      - "title: 'Weekly Report â€” {year}-W{week}'"
      - "tags: ['weekly','kpi','noctria']"
    sections:
      - id: "header"
        title: "# Weekly Review â€” {year}-W{week}"
        body: "æœŸé–“: {from_date}ã€œ{to_date}ï¼ˆJSTï¼‰"
      - id: "trend"
        title: "## KPI Trend"
        body: |
          - Brier: {brier_trend_line}
          - ECE: {ece_trend_line}
          - Adv.Pass: {adv_trend_line}
          - è»¢æ›ç‚¹/ã‚¤ãƒ™ãƒ³ãƒˆ: {events_one_line}
      - id: "wins_losses"
        title: "## Wins / Losses"
        body: |
          **Wins**
          - {win_1}
          - {win_2}
          **Losses**
          - {loss_1}
          - {loss_2}
      - id: "changes"
        title: "## å¤‰æ›´ç®¡ç†ã®é€²æ—"
        body: |
          - èµ·ç¥¨: {changes_open_count} / å®Œäº†: {changes_closed_count} / ä¿ç•™: {changes_onhold_count}
          - æ³¨ç›®: {one_change_link_or_dash}
      - id: "next_week_focus"
        title: "## æ¥é€±ã®ç„¦ç‚¹ï¼ˆæœ€å¤§3ç‚¹ï¼‰"
        body: |
          1) {focus1}
          2) {focus2}
          3) {focus3}
      - id: "repro_footer"
        title: "## Reproducibility"
        body: |
          - git_sha: `{git_sha}`
          - data_snapshot_id: `{data_snapshot_id}`

  monthly:
    path: "docs/reports/monthly/{YYYY-MM}.md"
    sections:
      - id: "header"
        title: "# Monthly Review â€” {year}-{month}"
        body: "å¯¾è±¡æœŸé–“: {from_date}ã€œ{to_date}"
      - id: "kpi_summary"
        title: "## KPI Summaryï¼ˆå¹³å‡/æœ€å°/æœ€å¤§/æ”¹å–„ç‡ï¼‰"
        body: |
          | metric | avg | min | max | Î” vs å‰æœˆ |
          |---|---:|---:|---:|---:|
          | Brier | {brier_avg:.4f} | {brier_min:.4f} | {brier_max:.4f} | {brier_mom_delta} |
          | ECE   | {ece_avg:.4f}   | {ece_min:.4f}   | {ece_max:.4f}   | {ece_mom_delta} |
          | Adv.Pass | {adv_avg:.4f} | {adv_min:.4f} | {adv_max:.4f} | {adv_mom_delta} |
      - id: "guardrails_review"
        title: "## ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«å†ç‚¹æ¤œ"
        body: |
          - kpi_targets: å¦¥å½“æ€§ {targets_ok|needs_update}ï¼ˆæ ¹æ‹ : {targets_reason}ï¼‰
          - automation_gates: {gates_ok|hold}ï¼ˆæ ¹æ‹ : {gates_reason}ï¼‰
      - id: "resource_allocation"
        title: "## ãƒªã‚½ãƒ¼ã‚¹å†é…åˆ†ã®è£å®š"
        body: |
          - é‡ç‚¹æŠ•è³‡é ˜åŸŸ: {priority_area_1}, {priority_area_2}
          - æ¸›é¡/åœæ­¢: {deprioritized_area_or_dash}
      - id: "governance_review"
        title: "## ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼"
        body: |
          - ä»Šæœˆã® change_management å®Ÿæ–½ä»¶æ•°: {changes_count}
          - open/closed/rollback: {changes_summary}
          - doc_ops ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹: {doc_ops_compliance_pct}%
      - id: "next_month_objectives"
        title: "## æ¥æœˆã®ç›®æ¨™ï¼ˆSMARTï¼‰"
        body: |
          1) {obj1}
          2) {obj2}
          3) {obj3}
      - id: "repro_footer"
        title: "## Reproducibility"
        body: |
          - git_sha: `{git_sha}`
          - data_snapshot_id: `{data_snapshot_id}`
