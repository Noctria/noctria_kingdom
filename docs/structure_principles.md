# 📘 Noctria Kingdom ディレクトリ構成設計原則（v2.0）

---

## 🧭 基本思想

> **「すべての知性は王の意志のもとに動き、Airflowはその意志を伝える伝令である」**

Noctria Kingdom は「自律戦略AI国家」であるという思想に基づき、  
**各知性（AI/戦略/評価/実行）を役割別に明確に分離し、Airflowはそれらを統括して順序立てて動かす“指揮官”に徹する構成**を採用する。

---

## 🏛 設計原則

| 原則 | 内容 |
|------|------|
| 📦 **役割ごとの責務分離** | モデル生成・評価・戦略・実行を物理ディレクトリで完全分離。機能の混在を禁止。 |
| 🔁 **Airflowは指揮官であり、ロジックを持たない** | Airflowは `airflow_docker/` に隔離し、全実装は外部コードを呼び出す形で管理。 |
| 📁 **戦略と実行を独立管理** | `strategies/` は戦略設計のためのコード/データ、`execution/` はMT5等での発注実行に特化。 |
| 🔄 **Veritas生成コードは隔離保存** | 自動生成戦略は `strategies/veritas_generated/` に保存。人手編集禁止。評価結果に応じて昇格。 |
| 📈 **データ・モデルはバージョン管理とアーカイブを徹底** | `data/`, `models/` は `archive/` や `latest/` を併用し、長期トラッキングを可能に。 |
| 🔧 **GUI/LLMサーバなど補助機能も原則分離** | `noctria_gui/`, `llm_server/` などは互いに干渉しないよう別ディレクトリで管理。 |
| 🧪 **tests/は常に外部モジュールを参照して実行可能な設計に** | 各ディレクトリと疎結合であることを前提とする。 |

---

## 🗂 ディレクトリ命名・配置ルール

| ディレクトリ | 説明 |
|--------------|------|
| `airflow_docker/` | Airflow実行に関するすべて（DAG、Dockerfile、補助スクリプト）を格納。外部コード呼び出し前提。 |
| `core/` | 共通ユーティリティ、環境定義、リスク管理、Noctriaの全体統制コード。 |
| `veritas/` | Veritas戦略AIのコード（生成、評価、テンプレート、Airflow連携スクリプト）を格納。 |
| `strategies/` | 手動戦略（`official/`）と自動生成戦略（`veritas_generated/`）を分離管理。 |
| `execution/` | MT5発注、取引記録、シミュレーション、成績評価など実行専用コード。 |
| `data/` | 生データ・加工データを `raw/`, `processed/`, `fundamental/` で分類。大容量ファイルは `.gitignore` 推奨。 |
| `models/` | モデルの保存場所。`latest/` はAirflowや推論サーバが参照、`archive/` は旧モデル保管。 |
| `llm_server/` | VeritasのFastAPI推論用サーバーコード。GPUノードや外部マシンと連携する前提。 |
| `noctria_gui/` | GUI構成（フロント/バック）とAPI中継コード。戦略や成績の可視化を目的とする。 |
| `experts/` | MT5 EA本体（.mq5ファイル）を保存。EA生成機構から出力される想定。 |
| `tools/` | 補助ツール、GitHub連携、パス変換、テンプレート出力など、管理補助目的のコード群。 |
| `tests/` | 単体・統合・シミュレーションなどのテスト群。自動実行を前提とする。 |
| `docs/` | README、設計書、運用マニュアルなど、技術文書類を格納。 |

---

## 📜 運用・拡張方針

- ✅ **GitHub連携**は `tools/github_push.py` 等で自動化し、Veritasによる生成内容の反映をAPI経由で実行  
- ✅ **Airflow <-> GUI連携**は FastAPI 経由で行い、GUIがトリガーを担う「司令本部」の役割  
- ✅ **MT5取引**は `execution/` のコードに集約し、Fintokei審査基準（DD, 日回数等）に対応  
- ✅ **学習モデルの保存・読込**は常に `models/latest/` を参照し、過去モデルは `archive/` にリネーム保管  
- ✅ **将来的なマルチ言語戦略（USDJPY, EURUSDなど）**も、`strategies/`, `data/`, `models/` 配下のサブディレクトリ追加で対応可能な構成  

---

## 🚫 `.gitignore` 推奨対象

